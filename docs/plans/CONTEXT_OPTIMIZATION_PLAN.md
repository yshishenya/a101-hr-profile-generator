# üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π

**–¶–µ–ª—å:** –°–æ–∫—Ä–∞—Ç–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å 158K –¥–æ 27K (83% —ç–∫–æ–Ω–æ–º–∏—è) –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏/—É–ª—É—á—à–µ–Ω–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-25
**–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Backend Team

---

## üìä –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

### –ê–Ω–∞–ª–∏–∑ —Ç–æ–∫–µ–Ω–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–Ω–∞ –æ–¥–Ω—É –≥–µ–Ω–µ—Ä–∞—Ü–∏—é):

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–æ–∫–µ–Ω—ã —Å–µ–π—á–∞—Å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –¢–æ–∫–µ–Ω—ã –Ω—É–∂–Ω–æ | –≠–∫–æ–Ω–æ–º–∏—è |
|-----------|---------------|---------------|--------------|----------|
| **OrgStructure** (–ø–æ–ª–Ω–∞—è) | 101,000 | ~5% | 5,000 | 96,000 (95%) |
| **company_map** | 51,000 | ~20% | 12,000 | 39,000 (76%) |
| **it_systems** | 4,500 | –∑–∞–≤–∏—Å–∏—Ç | 0-4,500 | 0-4,500 |
| **kpi_data** | 1,000 | 100% | 1,000 | 0 |
| **org_structure** (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è) | 500 | 100% | 500 | 0 |
| **json_schema** | 100 | 100% | 100 | 0 |
| **–ü—Ä–æ—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** | 900 | 100% | 900 | 0 |
| **–ò–¢–û–ì–û** | **158,000** | - | **24,000** | **134,000 (85%)** |

### –ü—Ä–æ–±–ª–µ–º—ã:
1. ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º –í–°–Æ –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—É (567 –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤) –≤–º–µ—Å—Ç–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –≤–µ—Ç–∫–∏
2. ‚úÖ –ö–∞—Ä—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ —Å–∂–∞—Ç–∞ (–º–Ω–æ–≥–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–π—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)
3. ‚úÖ IT —Å–∏—Å—Ç–µ–º—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã
4. ‚úÖ –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (4 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –£–º–Ω–∞—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—è –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
**–¶–µ–ª—å:** 101K ‚Üí 5K —Ç–æ–∫–µ–Ω–æ–≤ (95% —ç–∫–æ–Ω–æ–º–∏—è)

### –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –°–∂–∞—Ç–∏–µ –∫–∞—Ä—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏
**–¶–µ–ª—å:** 51K ‚Üí 12K —Ç–æ–∫–µ–Ω–æ–≤ (76% —ç–∫–æ–Ω–æ–º–∏—è)

### –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –£—Å–ª–æ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ IT —Å–∏—Å—Ç–µ–º
**–¶–µ–ª—å:** 0-4.5K —Ç–æ–∫–µ–Ω–æ–≤ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)

### –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
**–¶–µ–ª—å:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –Ω–∞ 90%

---

## üìã –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï 1: –£–º–Ω–∞—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—è –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –ó–∞–¥–∞—á–∞ 1.1: –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –≤–µ—Ç–∫–∏

**–§–∞–π–ª:** `backend/core/data_loader.py`
**–ú–µ—Ç–æ–¥:** `_extract_relevant_org_branch()`
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô
**–í—Ä–µ–º—è:** 4-6 —á–∞—Å–æ–≤

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
–í–º–µ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∏ –≤—Å–µ—Ö 567 –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤, –ø–µ—Ä–µ–¥–∞–µ–º:
- –¶–µ–ª–µ–≤–æ–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- 2 —É—Ä–æ–≤–Ω—è –≤–≤–µ—Ä—Ö (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã)
- 1 —É—Ä–æ–≤–µ–Ω—å –≤–Ω–∏–∑ (–¥–æ—á–µ—Ä–Ω–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è)
- –°–≤–æ–¥–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –æ—Å—Ç–∞–ª—å–Ω—ã–º

#### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º:

```python
def _extract_relevant_org_branch(
    self,
    target_path: str,
    levels_up: int = 2,
    levels_down: int = 1
) -> Dict[str, Any]:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é —á–∞—Å—Ç—å –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è.

    Args:
        target_path: –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ü–µ–ª–µ–≤–æ–º—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é (dept/position)
        levels_up: –°–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –≤–≤–µ—Ä—Ö –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –≤–∫–ª—é—á–∏—Ç—å (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
        levels_down: –°–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –≤–Ω–∏–∑ –≤–∫–ª—é—á–∏—Ç—å (–ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–µ)

    Returns:
        –°–∂–∞—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

    Example:
        # –ë—ã–ª–æ: 567 –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤, 101K —Ç–æ–∫–µ–Ω–æ–≤
        # –°—Ç–∞–ª–æ: ~15 –µ–¥–∏–Ω–∏—Ü, 5K —Ç–æ–∫–µ–Ω–æ–≤
    """
    # –®–ê–ì 1: –ù–∞–π—Ç–∏ —Ü–µ–ª–µ–≤–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
    target_unit = organization_cache.find_unit_by_path(target_path)
    if not target_unit:
        return self._create_minimal_fallback(target_path)

    # –®–ê–ì 2: –ü–æ–ª—É—á–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é —Ü–µ–ø–æ—á–∫—É (–≤–≤–µ—Ä—Ö –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏)
    parent_chain = self._get_parent_chain(target_path, levels_up)

    # –®–ê–ì 3: –ü–æ–ª—É—á–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (–≤–Ω–∏–∑ –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏)
    children_tree = self._get_children_tree(target_unit, levels_down)

    # –®–ê–ì 4: –ü–æ–ª—É—á–∏—Ç—å peer departments (–Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ)
    peers = self._get_peer_units(target_path, max_peers=5)

    # –®–ê–ì 5: –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Å—Ç–∞–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
    org_summary = self._get_organization_summary()

    # –®–ê–ì 6: –°–æ–±—Ä–∞—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    optimized_structure = {
        "target": {
            "path": target_path,
            "name": target_unit["name"],
            "level": target_unit["level"],
            "positions": target_unit["positions"],
            "headcount": target_unit.get("headcount", 0),
            "full_details": True  # –§–ª–∞–≥, —á—Ç–æ —ç—Ç–æ —Ü–µ–ª–µ–≤–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
        },
        "hierarchy": {
            "parent_chain": parent_chain,  # –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–≤–µ—Ä—Ö—É
            "children": children_tree,  # –ü–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–µ
            "peers": peers  # –°–æ—Å–µ–¥–∏ –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ
        },
        "organization_context": org_summary,  # –û–±—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∞
        "metadata": {
            "total_units_in_full_structure": 567,
            "units_included_in_context": len(parent_chain) + len(children_tree) + len(peers) + 1,
            "compression_ratio": f"{((567 - (len(parent_chain) + len(children_tree) + len(peers) + 1)) / 567 * 100):.1f}%"
        }
    }

    return optimized_structure
```

#### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

```python
def _get_parent_chain(self, target_path: str, levels: int) -> List[Dict[str, Any]]:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ü–µ–ø–æ—á–∫—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –≤–≤–µ—Ä—Ö –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏.

    Example:
        target_path = "–ë–ª–æ–∫ —Ä–∞–∑–≤–∏—Ç–∏—è/–î–ò–¢/–û—Ç–¥–µ–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/–ì—Ä—É–ø–ø–∞ backend"
        levels = 2

        Result: [
            {"name": "–î–ò–¢", "level": 2, "positions_count": 45, ...},
            {"name": "–ë–ª–æ–∫ —Ä–∞–∑–≤–∏—Ç–∏—è", "level": 1, "positions_count": 150, ...}
        ]
    """
    path_parts = [p.strip() for p in target_path.split("/") if p.strip()]
    parent_chain = []

    # –ò–¥–µ–º –æ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –≤–≤–µ—Ä—Ö
    for i in range(1, min(levels + 1, len(path_parts))):
        parent_path = "/".join(path_parts[:-i])
        parent_unit = organization_cache.find_unit_by_path(parent_path)

        if parent_unit:
            parent_chain.append({
                "name": parent_unit["name"],
                "path": parent_path,
                "level": parent_unit["level"],
                "positions_count": len(parent_unit["positions"]),
                "headcount": parent_unit.get("headcount", 0),
                # –ù–ï –≤–∫–ª—é—á–∞–µ–º –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü–∏–π - —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            })

    return parent_chain


def _get_children_tree(self, unit: Dict[str, Any], levels: int) -> List[Dict[str, Any]]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ä–µ–≤–æ –¥–æ—á–µ—Ä–Ω–∏—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –≤–Ω–∏–∑ –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏.

    Example:
        unit = "–û—Ç–¥–µ–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
        levels = 1

        Result: [
            {"name": "–ì—Ä—É–ø–ø–∞ backend", "positions_count": 12, ...},
            {"name": "–ì—Ä—É–ø–ø–∞ frontend", "positions_count": 8, ...},
            {"name": "–ì—Ä—É–ø–ø–∞ mobile", "positions_count": 6, ...}
        ]
    """
    children = []

    if levels <= 0 or "children" not in unit:
        return children

    for child_name, child_data in unit.get("children", {}).items():
        child_info = {
            "name": child_name,
            "positions_count": len(child_data.get("positions", [])),
            "headcount": child_data.get("headcount", 0),
            # –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è (–µ—Å–ª–∏ levels > 1)
        }

        if levels > 1:
            child_info["children"] = self._get_children_tree(child_data, levels - 1)

        children.append(child_info)

    return children


def _get_peer_units(self, target_path: str, max_peers: int = 5) -> List[Dict[str, Any]]:
    """
    –ü–æ–ª—É—á–∏—Ç—å peer –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (–Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏).

    –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: "–ö–∞–∫–∏–µ –µ—â–µ –æ—Ç–¥–µ–ª—ã –µ—Å—Ç—å –≤ —ç—Ç–æ–º –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–µ?"

    Example:
        target_path = "–ë–ª–æ–∫ —Ä–∞–∑–≤–∏—Ç–∏—è/–î–ò–¢/–û—Ç–¥–µ–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"

        Result: [
            {"name": "–û—Ç–¥–µ–ª –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã", "positions_count": 20, ...},
            {"name": "–û—Ç–¥–µ–ª –∞–Ω–∞–ª–∏—Ç–∏–∫–∏", "positions_count": 15, ...},
            {"name": "–û—Ç–¥–µ–ª –ø–æ–¥–¥–µ—Ä–∂–∫–∏", "positions_count": 18, ...}
        ]
    """
    path_parts = [p.strip() for p in target_path.split("/") if p.strip()]

    if len(path_parts) < 2:
        return []  # –ù–µ—Ç peer'–æ–≤ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ

    # –ü–æ–ª—É—á–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
    parent_path = "/".join(path_parts[:-1])
    parent_unit = organization_cache.find_unit_by_path(parent_path)

    if not parent_unit or "children" not in parent_unit:
        return []

    # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ—Ö "–±—Ä–∞—Ç—å–µ–≤/—Å–µ—Å—Ç–µ—Ä" (–∫—Ä–æ–º–µ —Å–∞–º–æ–≥–æ target)
    target_name = path_parts[-1]
    peers = []

    for peer_name, peer_data in parent_unit["children"].items():
        if peer_name != target_name:  # –ò—Å–∫–ª—é—á–∞–µ–º —Å–∞–º target
            peers.append({
                "name": peer_name,
                "positions_count": len(peer_data.get("positions", [])),
                "headcount": peer_data.get("headcount", 0)
            })

            if len(peers) >= max_peers:
                break

    return peers


def _get_organization_summary(self) -> Dict[str, Any]:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–¥–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

    –î–∞–µ—Ç –æ–±—â–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏.

    Result: {
        "total_business_units": 567,
        "total_positions": 1487,
        "total_headcount": 2500,
        "major_blocks": [
            {"name": "–ë–ª–æ–∫ —Ä–∞–∑–≤–∏—Ç–∏—è", "headcount": 450, "units_count": 120},
            {"name": "–ë–ª–æ–∫ –∫–æ–º–º–µ—Ä—Ü–∏–∏", "headcount": 380, "units_count": 95},
            ...
        ]
    }
    """
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ organization_cache
    all_units = organization_cache.get_all_business_units_with_paths()

    total_headcount = 0
    total_positions = 0
    blocks_summary = {}

    for path, unit in all_units.items():
        total_positions += len(unit.get("positions", []))
        total_headcount += unit.get("headcount", 0)

        # –ò–∑–≤–ª–µ–∫–∞–µ–º –±–ª–æ–∫ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
        path_parts = path.split("/")
        if len(path_parts) > 0:
            block_name = path_parts[0]

            if block_name not in blocks_summary:
                blocks_summary[block_name] = {
                    "name": block_name,
                    "headcount": 0,
                    "units_count": 0
                }

            blocks_summary[block_name]["headcount"] += unit.get("headcount", 0)
            blocks_summary[block_name]["units_count"] += 1

    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –±–ª–æ–∫–∏ –ø–æ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ (—Ç–æ–ø-5)
    top_blocks = sorted(
        blocks_summary.values(),
        key=lambda x: x["headcount"],
        reverse=True
    )[:5]

    return {
        "total_business_units": len(all_units),
        "total_positions": total_positions,
        "total_headcount": total_headcount,
        "major_blocks": top_blocks
    }
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ prepare_langfuse_variables():

```python
# –í –º–µ—Ç–æ–¥–µ prepare_langfuse_variables() –≤ data_loader.py

# ‚ùå –°–¢–ê–†–´–ô –ö–û–î (—É–¥–∞–ª–∏—Ç—å):
"OrgStructure": json.dumps(
    self._get_organization_structure_with_target(f"{department}/{position}"),
    ensure_ascii=False,
    indent=2,
),  # 101K —Ç–æ–∫–µ–Ω–æ–≤

# ‚úÖ –ù–û–í–´–ô –ö–û–î (–¥–æ–±–∞–≤–∏—Ç—å):
"OrgStructure": json.dumps(
    self._extract_relevant_org_branch(
        target_path=f"{department}/{position}",
        levels_up=2,
        levels_down=1
    ),
    ensure_ascii=False,
    indent=2,
),  # ~5K —Ç–æ–∫–µ–Ω–æ–≤ (95% —ç–∫–æ–Ω–æ–º–∏—è)
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç –≤ tests/test_data_loader_optimization.py

def test_extract_relevant_org_branch():
    """–¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—ã"""
    loader = DataLoader()

    # –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
    target_path = "–ë–ª–æ–∫ —Ä–∞–∑–≤–∏—Ç–∏—è/–î–ò–¢/–û—Ç–¥–µ–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
    result = loader._extract_relevant_org_branch(target_path)

    result_json = json.dumps(result, ensure_ascii=False)
    result_tokens = len(result_json) / 3.5  # –û—Ü–µ–Ω–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤

    assert result_tokens < 6000, f"–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤: {result_tokens}"
    assert result_tokens > 4000, f"–°–ª–∏—à–∫–æ–º –º–∞–ª–æ —Ç–æ–∫–µ–Ω–æ–≤: {result_tokens}"

    # –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    assert "target" in result
    assert "hierarchy" in result
    assert "organization_context" in result

    # –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    assert result["target"]["full_details"] == True
    assert len(result["hierarchy"]["parent_chain"]) <= 2
    assert "metadata" in result

    print(f"‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω! –¢–æ–∫–µ–Ω—ã: {result_tokens:.0f}")
```

#### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞:

- ‚úÖ –¢–æ–∫–µ–Ω—ã: < 6,000 (–±—ã–ª–æ 101,000)
- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: < 50ms
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: –Ω–µ —É—Ö—É–¥—à–∞–µ—Ç—Å—è
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## üìã –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï 2: –°–∂–∞—Ç–∏–µ –∫–∞—Ä—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏

### –ó–∞–¥–∞—á–∞ 2.1: –°–æ–∑–¥–∞—Ç—å —Å–∂–∞—Ç—É—é –≤–µ—Ä—Å–∏—é –∫–∞—Ä—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏

**–§–∞–π–ª:** `backend/core/data_loader.py`
**–ú–µ—Ç–æ–¥:** `_load_company_map_compressed()`
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í–´–°–û–ö–ò–ô
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞

#### –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∫–∞—Ä—Ç—ã:

```markdown
# –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä: ~110,000 —Å–∏–º–≤–æ–ª–æ–≤ (~51K —Ç–æ–∫–µ–Ω–æ–≤)

–ü—Ä–æ–±–ª–µ–º—ã:
1. –ú–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤/—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
3. –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
4. –î–ª–∏–Ω–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–ø—Ä–∞–≤–∫–∏
```

#### –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–∂–∞—Ç–∏—è:

```python
def _load_company_map_compressed(self) -> str:
    """
    –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∂–∞—Ç–æ–π –≤–µ—Ä—Å–∏–∏ –∫–∞—Ä—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏ –ê101.

    –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
    1. –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–µ–∫—Ü–∏–π
    2. –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ (–æ—Å—Ç–∞–≤–∏—Ç—å 1-2 –∫–ª—é—á–µ–≤—ã—Ö)
    3. –£–¥–∞–ª–µ–Ω–∏–µ markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ª–∏—à–Ω–∏–µ #, -, *)
    4. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ–∫—Ü–∏–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π

    –¶–µ–ª—å: 110K —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí 30K —Å–∏–º–≤–æ–ª–æ–≤ (73% —Å–∂–∞—Ç–∏–µ)
    """
    cache_key = "company_map_compressed"

    if cache_key not in self._cache:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç—É
        full_map = self._load_company_map_cached()

        # –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∂–∞—Ç–∏–µ
        compressed_map = self._apply_company_map_compression(full_map)

        self._cache[cache_key] = compressed_map

        logger.info(
            f"Company map compressed: {len(full_map)} ‚Üí {len(compressed_map)} chars "
            f"({(1 - len(compressed_map)/len(full_map))*100:.1f}% compression)"
        )

    return self._cache[cache_key]


def _apply_company_map_compression(self, full_map: str) -> str:
    """
    –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —Å–∂–∞—Ç–∏—è –∫ –∫–∞—Ä—Ç–µ –∫–æ–º–ø–∞–Ω–∏–∏.

    –®–∞–≥–∏:
    1. –ü–∞—Ä—Å–∏–Ω–≥ markdown —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ–∫—Ü–∏–π
    3. –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏
    4. –°–±–æ—Ä–∫–∞ —Å–∂–∞—Ç–æ–π –≤–µ—Ä—Å–∏–∏
    """

    # –®–ê–ì 1: –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ (–Ω—É–∂–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π)
    CRITICAL_SECTIONS = [
        "–ú–∏—Å—Å–∏—è –∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –ê101",
        "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞",
        "–ö–ª—é—á–µ–≤—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
        "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)",
        "HR –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã",
        # –ù–ï –≤–∫–ª—é—á–∞–µ–º: –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–ø—Ä–∞–≤–∫–∏, –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
    ]

    # –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–π
    sections = self._parse_markdown_sections(full_map)

    # –®–ê–ì 3: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è + —Å–∂–∞—Ç–∏–µ –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏
    compressed_sections = []

    for section in sections:
        if self._is_critical_section(section["title"], CRITICAL_SECTIONS):
            # –°–∂–∏–º–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Å–µ–∫—Ü–∏–∏
            compressed_content = self._compress_section_content(section["content"])
            compressed_sections.append({
                "title": section["title"],
                "content": compressed_content
            })

    # –®–ê–ì 4: –°–±–æ—Ä–∫–∞ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    compressed_map = "# –ö–∞—Ä—Ç–∞ –ö–æ–º–ø–∞–Ω–∏–∏ –ê101 (–°–∂–∞—Ç–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π)\n\n"

    for section in compressed_sections:
        compressed_map += f"## {section['title']}\n\n"
        compressed_map += f"{section['content']}\n\n"

    return compressed_map


def _compress_section_content(self, content: str) -> str:
    """
    –°–∂–∞—Ç–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–µ–∫—Ü–∏–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

    –¢–µ—Ö–Ω–∏–∫–∏:
    1. –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    2. –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ (—Ç–æ–ø-5 –≤–º–µ—Å—Ç–æ —Ç–æ–ø-20)
    3. –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ (–æ—Å—Ç–∞–≤–∏—Ç—å 1 –∫–ª—é—á–µ–≤–æ–π)
    4. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–∏—Ö –ø—É–Ω–∫—Ç–æ–≤
    """

    # –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–µ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    content = content.replace("**", "").replace("*", "")
    content = content.replace("---", "")

    # –°–æ–∫—Ä–∞—â–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
    lines = content.split("\n")
    compressed_lines = []
    list_item_count = 0
    in_list = False

    for line in lines:
        # –ï—Å–ª–∏ —ç—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞
        if line.strip().startswith("-") or line.strip().startswith("‚Ä¢"):
            if not in_list:
                in_list = True
                list_item_count = 0

            list_item_count += 1

            # –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–ø-5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø–∏—Å–∫–∞
            if list_item_count <= 5:
                compressed_lines.append(line)
            elif list_item_count == 6:
                compressed_lines.append("  - ... (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –æ–ø—É—â–µ–Ω—ã)")
        else:
            in_list = False
            compressed_lines.append(line)

    return "\n".join(compressed_lines)
```

#### –°–æ–∑–¥–∞–Ω–∏–µ —Å–∂–∞—Ç–æ–π –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–∞:

```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∂–∞—Ç–æ–π –∫–∞—Ä—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏
# scripts/create_compressed_company_map.py

import sys
sys.path.append(".")

from backend.core.data_loader import DataLoader

loader = DataLoader()

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ —Å–∂–∏–º–∞–µ–º
full_map = loader._load_company_map_cached()
compressed_map = loader._apply_company_map_compression(full_map)

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª
with open("data/–ö–∞—Ä—Ç–∞ –ö–æ–º–ø–∞–Ω–∏–∏ –ê101 (—Å–∂–∞—Ç–∞—è).md", "w", encoding="utf-8") as f:
    f.write(compressed_map)

print(f"‚úÖ –°–∂–∞—Ç–∞—è –∫–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞!")
print(f"   –û—Ä–∏–≥–∏–Ω–∞–ª: {len(full_map):,} —Å–∏–º–≤–æ–ª–æ–≤")
print(f"   –°–∂–∞—Ç–∞—è: {len(compressed_map):,} —Å–∏–º–≤–æ–ª–æ–≤")
print(f"   –≠–∫–æ–Ω–æ–º–∏—è: {(1 - len(compressed_map)/len(full_map))*100:.1f}%")
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:

```python
# –í –º–µ—Ç–æ–¥–µ prepare_langfuse_variables()

# ‚ùå –°–¢–ê–†–´–ô –ö–û–î:
"company_map": self._load_company_map_cached(),  # 51K —Ç–æ–∫–µ–Ω–æ–≤

# ‚úÖ –ù–û–í–´–ô –ö–û–î:
"company_map": self._load_company_map_compressed(),  # ~12K —Ç–æ–∫–µ–Ω–æ–≤
```

#### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞:

- ‚úÖ –¢–æ–∫–µ–Ω—ã: < 15,000 (–±—ã–ª–æ 51,000)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ–∫—Ü–∏–∏
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ —É—Ö—É–¥—à–∏–ª–æ—Å—å

---

## üìã –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï 3: –£—Å–ª–æ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ IT —Å–∏—Å—Ç–µ–º

### –ó–∞–¥–∞—á–∞ 3.1: –ó–∞–≥—Ä—É–∂–∞—Ç—å IT —Å–∏—Å—Ç–µ–º—ã —Ç–æ–ª—å–∫–æ –¥–ª—è IT-–¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤

**–§–∞–π–ª:** `backend/core/data_loader.py`
**–ú–µ—Ç–æ–¥:** `_load_it_systems_conditional()`
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –°–†–ï–î–ù–ò–ô
**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞

#### –õ–æ–≥–∏–∫–∞:

```python
def _should_load_it_systems(self, department: str, position: str) -> bool:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å IT —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –¥–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏.

    IT —Å–∏—Å—Ç–µ–º—ã —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è:
    1. IT –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ (–î–ò–¢, –¶–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è, etc)
    2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø–æ–∑–∏—Ü–∏–π –≤ –¥—Ä—É–≥–∏—Ö –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞—Ö
    3. –ü–æ–∑–∏—Ü–∏–π, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ (–ê–Ω–∞–ª–∏—Ç–∏–∫, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
    """

    # –°–ø–∏—Å–æ–∫ IT –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤
    IT_DEPARTMENTS = [
        "–î–ò–¢",
        "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π",
        "–û—Ç–¥–µ–ª —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏–∏",
        "–î–∏—Ä–µ–∫—Ü–∏—è –ø–æ —Ü–∏—Ñ—Ä–æ–≤–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏",
    ]

    # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (–ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º)
    TECHNICAL_KEYWORDS = [
        "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç", "—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫", "developer",
        "–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä", "–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", "devops",
        "–∞–Ω–∞–ª–∏—Ç–∏–∫", "analyst", "bi", "data",
        "qa", "—Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫", "–∏–Ω–∂–µ–Ω–µ—Ä"
    ]

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: IT –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç?
    for it_dept in IT_DEPARTMENTS:
        if it_dept.lower() in department.lower():
            return True

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–∑–∏—Ü–∏—è?
    position_lower = position.lower()
    for keyword in TECHNICAL_KEYWORDS:
        if keyword in position_lower:
            return True

    return False


def _load_it_systems_conditional(
    self,
    department: str,
    position: str
) -> str:
    """
    –£—Å–ª–æ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ IT —Å–∏—Å—Ç–µ–º.

    –ï—Å–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    –ï—Å–ª–∏ –Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫—Ä–∞—Ç–∫—É—é —Å–ø—Ä–∞–≤–∫—É –∏–ª–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
    """

    if self._should_load_it_systems(department, position):
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        logger.info(f"Loading IT systems for {department}/{position} (relevant)")
        return self._load_it_systems_cached()
    else:
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫—Ä–∞—Ç–∫—É—é —Å–ø—Ä–∞–≤–∫—É
        logger.info(f"Skipping IT systems for {department}/{position} (not relevant)")
        return """# IT –°–∏—Å—Ç–µ–º—ã –∫–æ–º–ø–∞–Ω–∏–∏ –ê101

–î–ª—è –¥–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ IT —Å–∏—Å—Ç–µ–º –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: –∫–æ–º–ø–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤."""
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:

```python
# –í –º–µ—Ç–æ–¥–µ prepare_langfuse_variables()

# ‚ùå –°–¢–ê–†–´–ô –ö–û–î:
"it_systems": self._load_it_systems_cached(),  # –í—Å–µ–≥–¥–∞ 4.5K —Ç–æ–∫–µ–Ω–æ–≤

# ‚úÖ –ù–û–í–´–ô –ö–û–î:
"it_systems": self._load_it_systems_conditional(department, position),  # 0-4.5K —Ç–æ–∫–µ–Ω–æ–≤
```

#### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞:

- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤: ~70% —Å–ª—É—á–∞–µ–≤ (–Ω–µ IT –ø–æ–∑–∏—Ü–∏–∏)
- ‚úÖ –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: -30% –¥–ª—è –Ω–µ IT –ø–æ–∑–∏—Ü–∏–π

---

## üìã –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï 4: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ó–∞–¥–∞—á–∞ 4.1: –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π

**–§–∞–π–ª:** `backend/core/context_cache.py` (–Ω–æ–≤—ã–π)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –°–†–ï–î–ù–ò–ô
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞

#### –ò–¥–µ—è:

–ï—Å–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥,
–º–Ω–æ–≥–∏–µ –¥–∞–Ω–Ω—ã–µ (–æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, KPI, –∫–∞—Ä—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏) –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```python
# backend/core/context_cache.py

from typing import Dict, Any, Optional
from datetime import datetime, timedelta
import hashlib
import json

class ContextCache:
    """
    –ö–µ—à –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π.

    –ö–µ—à–∏—Ä—É–µ—Ç:
    1. –ò–∑–≤–ª–µ—á–µ–Ω–Ω—É—é –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞
    2. –°–∂–∞—Ç—É—é –∫–∞—Ä—Ç—É –∫–æ–º–ø–∞–Ω–∏–∏
    3. KPI –¥–∞–Ω–Ω—ã–µ

    TTL: 1 —á–∞—Å (–¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–µ–¥–∫–æ)
    """

    def __init__(self, ttl_seconds: int = 3600):
        self._cache: Dict[str, Dict[str, Any]] = {}
        self._timestamps: Dict[str, datetime] = {}
        self.ttl = timedelta(seconds=ttl_seconds)

    def get_org_structure(
        self,
        department: str,
        position: str
    ) -> Optional[Dict[str, Any]]:
        """–ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—É"""
        cache_key = self._make_org_key(department, position)
        return self._get_cached_value(cache_key)

    def set_org_structure(
        self,
        department: str,
        position: str,
        structure: Dict[str, Any]
    ):
        """–ó–∞–∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—É"""
        cache_key = self._make_org_key(department, position)
        self._set_cached_value(cache_key, structure)

    def _make_org_key(self, department: str, position: str) -> str:
        """–°–æ–∑–¥–∞—Ç—å –∫–ª—é—á –∫–µ—à–∞ –¥–ª—è –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—ã"""
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º hash –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏
        data = f"org:{department}:{position}"
        return hashlib.md5(data.encode()).hexdigest()

    def _get_cached_value(self, key: str) -> Optional[Any]:
        """–ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π TTL"""
        if key not in self._cache:
            return None

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º TTL
        if datetime.now() - self._timestamps[key] > self.ttl:
            # –ö–µ—à –∏—Å—Ç–µ–∫
            del self._cache[key]
            del self._timestamps[key]
            return None

        return self._cache[key]

    def _set_cached_value(self, key: str, value: Any):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–µ—à"""
        self._cache[key] = value
        self._timestamps[key] = datetime.now()

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
context_cache = ContextCache(ttl_seconds=3600)  # 1 —á–∞—Å
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ DataLoader:

```python
# –í –º–µ—Ç–æ–¥–µ prepare_langfuse_variables()

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à
cached_org = context_cache.get_org_structure(department, position)

if cached_org:
    logger.info(f"Using cached org structure for {department}/{position}")
    org_structure = cached_org
else:
    logger.info(f"Generating org structure for {department}/{position}")
    org_structure = self._extract_relevant_org_branch(
        target_path=f"{department}/{position}"
    )

    # –ö–µ—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    context_cache.set_org_structure(department, position, org_structure)
```

#### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞:

- ‚úÖ –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏—è—Ö: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ 90%
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è CPU –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## üìä –°—É–º–º–∞—Ä–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–æ–∫–µ–Ω—ã |
|-----------|--------|
| OrgStructure | 101,000 |
| company_map | 51,000 |
| it_systems | 4,500 |
| –û—Å—Ç–∞–ª—å–Ω–æ–µ | 1,500 |
| **–ò–¢–û–ì–û** | **158,000** |

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–æ–∫–µ–Ω—ã | –≠–∫–æ–Ω–æ–º–∏—è |
|-----------|--------|----------|
| OrgStructure (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è) | 5,000 | 96,000 (95%) |
| company_map (—Å–∂–∞—Ç–∞—è) | 12,000 | 39,000 (76%) |
| it_systems (—É—Å–ª–æ–≤–Ω–∞—è) | 1,500 | 3,000 (67%) |
| –û—Å—Ç–∞–ª—å–Ω–æ–µ | 1,500 | 0 |
| **–ò–¢–û–ì–û** | **20,000** | **138,000 (87%)** |

### –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —ç–∫–æ–Ω–æ–º–∏—è (–Ω–∞ 1000 –ø—Ä–æ—Ñ–∏–ª–µ–π):

- **–î–æ:** $5.22
- **–ü–æ—Å–ª–µ:** $0.66
- **–≠–ö–û–ù–û–ú–ò–Ø:** $4.56 (87%)

---

## üóìÔ∏è –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ü–æ—à–∞–≥–æ–≤—ã–π)

### –î–µ–Ω—å 1 (6 —á–∞—Å–æ–≤):

**09:00-11:00** - –ó–∞–¥–∞—á–∞ 1.1: –°–æ–∑–¥–∞—Ç—å `_extract_relevant_org_branch()`
- –ù–∞–ø–∏—Å–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
- –ù–∞–ø–∏—Å–∞—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- –î–æ–±–∞–≤–∏—Ç—å docstrings

**11:00-12:00** - –û–±–µ–¥

**12:00-14:00** - –ó–∞–¥–∞—á–∞ 1.1 (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ): –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–æ–∑–¥–∞—Ç—å unit —Ç–µ—Å—Ç—ã
- –ü—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –ó–∞–º–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω—ã

**14:00-16:00** - –ó–∞–¥–∞—á–∞ 1.1 (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ): –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å `prepare_langfuse_variables()`
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–µ —É–ø–∞–ª–æ

**16:00-17:00** - Code review + –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–µ–Ω—å 2 (4 —á–∞—Å–∞):

**09:00-11:00** - –ó–∞–¥–∞—á–∞ 2.1: –°–∂–∞—Ç–∏–µ –∫–∞—Ä—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏
- –ù–∞–ø–∏—Å–∞—Ç—å `_apply_company_map_compression()`
- –°–æ–∑–¥–∞—Ç—å —Å–∂–∞—Ç—É—é –≤–µ—Ä—Å–∏—é —Ñ–∞–π–ª–∞

**11:00-12:00** - –û–±–µ–¥

**12:00-13:00** - –ó–∞–¥–∞—á–∞ 2.1 (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ): –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è
- –ó–∞–º–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω—ã

**13:00-14:00** - –ó–∞–¥–∞—á–∞ 2.1 (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ): –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å `prepare_langfuse_variables()`

### –î–µ–Ω—å 3 (4 —á–∞—Å–∞):

**09:00-11:00** - –ó–∞–¥–∞—á–∞ 3.1: –£—Å–ª–æ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ IT —Å–∏—Å—Ç–µ–º
- –ù–∞–ø–∏—Å–∞—Ç—å `_should_load_it_systems()`
- –ù–∞–ø–∏—Å–∞—Ç—å `_load_it_systems_conditional()`

**11:00-12:00** - –û–±–µ–¥

**12:00-13:00** - –ó–∞–¥–∞—á–∞ 3.1 (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ): –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**13:00-14:00** - –ó–∞–¥–∞—á–∞ 4.1: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –°–æ–∑–¥–∞—Ç—å `ContextCache` –∫–ª–∞—Å—Å
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ DataLoader

### –î–µ–Ω—å 4 (4 —á–∞—Å–∞):

**09:00-11:00** - –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
- End-to-end —Ç–µ—Å—Ç—ã
- –ó–∞–º–µ—Ä –º–µ—Ç—Ä–∏–∫ (—Ç–æ–∫–µ–Ω—ã, –≤—Ä–µ–º—è, –∫–∞—á–µ—Å—Ç–≤–æ)

**11:00-12:00** - –û–±–µ–¥

**12:00-14:00** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è + —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- –û–±–Ω–æ–≤–∏—Ç—å README
- –°–æ–∑–¥–∞—Ç—å migration guide
- Deploy –Ω–∞ staging

### –î–µ–Ω—å 5 (2 —á–∞—Å–∞):

**09:00-10:00** - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ production
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
- –°–æ–±—Ä–∞—Ç—å feedback

**10:00-11:00** - –†–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–∞ + –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º

- [ ] –í—Å–µ unit —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ó–∞–º–µ—Ä–µ–Ω—ã —Ç–æ–∫–µ–Ω—ã (—Ü–µ–ª—å: < 25,000)
- [ ] –ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ —É—Ö—É–¥—à–∏–ª–æ—Å—å (A/B —Ç–µ—Å—Ç)
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] Code review –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] Staging —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] –°–æ–∑–¥–∞–Ω rollback –ø–ª–∞–Ω
- [ ] –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞

---

## üö® –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –ü–æ—Ç–µ—Ä—è –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ:** –í—ã—Å–æ–∫–æ–µ

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 50 –ø—Ä–æ—Ñ–∏–ª—è—Ö –¥–æ –∏ –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ completeness_score –∏ validation_score
- –ï—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –ø–∞–¥–∞–µ—Ç > 5% ‚Üí –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –†–∏—Å–∫ 2: –û—à–∏–±–∫–∏ –≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ:** –°—Ä–µ–¥–Ω–µ–µ

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- Comprehensive unit —Ç–µ—Å—Ç—ã –¥–ª—è edge cases
- Fallback –∫ –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ fallback —Å—Ä–∞–±–æ—Ç–∞–ª

### –†–∏—Å–∫ 3: –ö–µ—à —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ:** –°—Ä–µ–¥–Ω–µ–µ

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- TTL = 1 —á–∞—Å (–¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–µ–¥–∫–æ)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–µ—à–µ

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:

- ‚úÖ –¢–æ–∫–µ–Ω—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: < 25,000 (—Å–µ–π—á–∞—Å 158,000)
- ‚úÖ –í—Ä–µ–º—è prepare_langfuse_variables(): < 100ms (—Å–µ–π—á–∞—Å ~300ms)
- ‚úÖ –°—Ç–æ–∏–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 1000 –ø—Ä–æ—Ñ–∏–ª–µ–π: < $1.00 (—Å–µ–π—á–∞—Å $5.22)

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

- ‚úÖ completeness_score: >= —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ validation_score: >= —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ Feedback –æ—Ç HR: "–∫–∞—á–µ—Å—Ç–≤–æ –Ω–µ —É—Ö—É–¥—à–∏–ª–æ—Å—å"

### –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ Code coverage: >= 80%
- ‚úÖ Zero production incidents

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

1. Generic KPI fallback (–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑ –∞–Ω–∞–ª–∏–∑–∞)
2. –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –æ–±—ä–µ–º–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π
3. –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ (—É–±—Ä–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è)
4. –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –æ—Ç HR

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Ä–µ—Å—É—Ä—Å—ã

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞](../analysis/context_collection_analysis.md)
- [–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–º–ø—Ç–∞](../analysis/prompt_analysis_report.md)
- [Feedback –∞–Ω–∞–ª–∏–∑](../analysis/feedback_inventory.md)

**–ö–æ–¥:**
- `backend/core/data_loader.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª
- `backend/core/organization_cache.py` - –∫–µ—à –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- `backend/core/context_cache.py` - –Ω–æ–≤—ã–π –∫–µ—à –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–¢–µ—Å—Ç—ã:**
- `tests/test_data_loader_optimization.py` - –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-25
**–í–µ—Ä—Å–∏—è:** 1.0

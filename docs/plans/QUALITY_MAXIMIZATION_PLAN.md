# üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HR –ø—Ä–æ—Ñ–∏–ª–µ–π

**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** Better context beats bigger context
**–¶–µ–ª—å:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–≤—ã—Å–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π (—Å 7/10 –¥–æ 9/10)
**–ü–æ–¥—Ö–æ–¥:** –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å > –ü–æ–ª–Ω–æ—Ç–∞ | –ü—Ä–∏–º–µ—Ä—ã > –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ > –û–±—ä–µ–º

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-25
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

---

## üìä –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ (Root Cause Analysis)

### –ß—Ç–æ –ø–æ–∫–∞–∑–∞–ª –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑:

**‚ùå –ü–†–û–ë–õ–ï–ú–ê –ù–ï –≤ –æ–±—ä–µ–º–µ —Ç–æ–∫–µ–Ω–æ–≤ (158K —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è Gemini 2.5)**

**‚úÖ –†–ï–ê–õ–¨–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: Signal-to-Noise Ratio = 1:30**

```
–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 158,000 —Ç–æ–∫–µ–Ω–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞                  ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ ‚ñà‚ñà‚ñà 5K —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö (3%)                    ‚îÇ  ‚Üê LLM —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –∑–¥–µ—Å—å
‚îÇ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë      ‚îÇ
‚îÇ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë      ‚îÇ  ‚Üê 153K —Ç–æ–∫–µ–Ω–æ–≤ –®–£–ú–ê
‚îÇ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë      ‚îÇ     (–Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
‚îÇ 153K –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö (97%)                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–≠—Ñ—Ñ–µ–∫—Ç: "Diluted Attention" - –≤–Ω–∏–º–∞–Ω–∏–µ LLM —Ä–∞–∑–º–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ 567 –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ö–∞—á–µ—Å—Ç–≤–æ 7/10 –≤–º–µ—Å—Ç–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö 9/10
```

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (5 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π)

### –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: üîç –ü–æ–≤—ã—à–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
**–¶–µ–ª—å:** Signal-to-Noise –æ—Ç 1:30 ‚Üí 2:1
**–≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ:** +30%

### –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: üìö Few-Shot Learning (–ø—Ä–∏–º–µ—Ä—ã)
**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å 2-3 —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è –≤ –ø—Ä–æ–º–ø—Ç
**–≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ:** +20%

### –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: ‚úÖ Pre-Flight –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–ª–Ω–æ—Ç—É/–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ü–ï–†–ï–î –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
**–≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ:** +15%

### –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4: üéØ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ KPI –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞
**–¶–µ–ª—å:** 1.6% ‚Üí 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ KPI
**–≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ:** +25%

### –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 5: üìã –£–ø—Ä–æ—â–µ–Ω–∏–µ JSON Schema
**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å, —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å LLM –Ω–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö
**–≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ:** +10%

**–ò–¢–û–ì–û:** +100% —É–ª—É—á—à–µ–Ω–∏–µ (7/10 ‚Üí 9/10)

---

## üìã –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï 1: –ü–æ–≤—ã—à–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞:
```
–°–µ–π—á–∞—Å –ø–µ—Ä–µ–¥–∞–µ–º:
- 567 –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ –≤ OrgStructure (—Ç–æ–ª—å–∫–æ 1 –Ω—É–∂–µ–Ω)
- –ü–æ–ª–Ω—É—é –∫–∞—Ä—Ç—É –∫–æ–º–ø–∞–Ω–∏–∏ –ê101 (110K —Å–∏–º–≤–æ–ª–æ–≤)
- IT —Å–∏—Å—Ç–µ–º—ã –≤—Å–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ (–Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è IT –ø–æ–∑–∏—Ü–∏–π)
```

### –†–µ—à–µ–Ω–∏–µ: –£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

#### –ó–∞–¥–∞—á–∞ 1.1: –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ö–†–ò–¢–ò–ß–ù–û –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞)

**–§–∞–π–ª:** `backend/core/data_loader.py`
**–ú–µ—Ç–æ–¥:** `_extract_relevant_org_branch_for_quality()`
**–í—Ä–µ–º—è:** 6-8 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

**–§–∏–ª–æ—Å–æ—Ñ–∏—è –ø–æ–¥—Ö–æ–¥–∞:**
- –ù–µ —É–±–∏—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏
- –£–±–∏—Ä–∞—Ç—å –ù–ï–†–ï–õ–ï–í–ê–ù–¢–ù–´–ô –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∏ LLM
- –î–æ–±–∞–≤–ª—è—Ç—å –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ô —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≥–¥–µ –Ω—É–∂–Ω–æ

**–ß—Ç–æ –ø–µ—Ä–µ–¥–∞–µ–º:**

```python
def _extract_relevant_org_branch_for_quality(
    self,
    target_path: str  # "–ë–ª–æ–∫ —Ä–∞–∑–≤–∏—Ç–∏—è/–î–ò–¢/–û—Ç–¥–µ–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/–ì—Ä—É–ø–ø–∞ backend"
) -> Dict[str, Any]:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ö–ê–ß–ï–°–¢–í–ï–ù–ù–û–ô –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è.

    –ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
    - –¶–µ–ª—å –ù–ï —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω—ã
    - –¶–µ–ª—å: –¥–∞—Ç—å LLM –¢–û–õ–¨–ö–û —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–∑–∏—Ü–∏–∏

    –ß—Ç–æ –≤–∫–ª—é—á–∞–µ–º (–¥–ª—è –ö–ê–ß–ï–°–¢–í–ê):
    1. –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¶–ï–õ–ï–í–û–ú –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏:
       - –í—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏
       - –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å (headcount)
       - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
       - KPI –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

    2. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–î–û 3 —É—Ä–æ–≤–Ω–µ–π –≤–≤–µ—Ä—Ö):
       - –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–Ω—è—Ç—å: "–≥–¥–µ —ç—Ç–∞ –ø–æ–∑–∏—Ü–∏—è –≤ –æ–±—â–µ–π –∫–∞—Ä—Ç–∏–Ω–µ?"
       - –ö–æ–º—É –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
       - –ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç

    3. –ü–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (1-2 —É—Ä–æ–≤–Ω—è –≤–Ω–∏–∑):
       - –î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∑–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
       - –†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö

    4. Peer –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (–¥–æ 10, –Ω–µ 5):
       - –î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è: "–∫–∞–∫ —ç—Ç–∞ –ø–æ–∑–∏—Ü–∏—è —Å–æ–æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏?"
       - –ö–∞—Ä—å–µ—Ä–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏

    5. –¢–∏–ø–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Å–º–µ–∂–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π (–ù–û–í–û–ï):
       - 2-3 –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–∑–∏—Ü–∏–π –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –Ω–∏–∂–µ (–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è source_positions)
       - 2-3 –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–∑–∏—Ü–∏–π –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ (–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è target_pathways)
       - –ü–æ–º–æ–≥–∞–µ—Ç LLM –ø–æ–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞

    –ß—Ç–æ –ù–ï –≤–∫–ª—é—á–∞–µ–º:
    - –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ü–µ–ª–µ–≤—ã–º
    - –ü–æ–ª–Ω—É—é –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Å–µ—Ö 567 —é–Ω–∏—Ç–æ–≤
    - –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∏–∑ –¥—Ä—É–≥–∏—Ö –±–ª–æ–∫–æ–≤ (–µ—Å–ª–∏ –Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ)
    """

    # –®–ê–ì 1: –ù–∞–π—Ç–∏ —Ü–µ–ª–µ–≤–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
    target_unit = organization_cache.find_unit_by_path(target_path)

    if not target_unit:
        logger.error(f"Target unit not found: {target_path}")
        return self._create_fallback_with_validation_error(target_path)

    # –®–ê–ì 2: –ü–æ–ª—É—á–∏—Ç—å –ü–û–õ–ù–£–Æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ü–µ–ª–µ–≤–æ–º –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏
    # (–ù–ï —Å–æ–∫—Ä–∞—â–∞–µ–º - —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞!)
    target_full_info = self._get_target_unit_full_details(target_unit, target_path)

    # –®–ê–ì 3: –ü–æ–ª—É—á–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é —Ü–µ–ø–æ—á–∫—É (3 —É—Ä–æ–≤–Ω—è –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
    parent_chain = self._get_parent_chain_detailed(
        target_path,
        levels=3  # –ë–æ–ª—å—à–µ —É—Ä–æ–≤–Ω–µ–π = –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    )

    # –®–ê–ì 4: –ü–æ–ª—É—á–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (2 —É—Ä–æ–≤–Ω—è)
    children_tree = self._get_children_tree_detailed(
        target_unit,
        levels=2  # –î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö
    )

    # –®–ê–ì 5: –ü–æ–ª—É—á–∏—Ç—å peer departments (10 –≤–º–µ—Å—Ç–æ 5 - –¥–ª—è –∫–∞—Ä—å–µ—Ä–Ω—ã—Ö –ø—É—Ç–µ–π)
    peers = self._get_peer_units_extended(
        target_path,
        max_peers=10  # –ë–æ–ª—å—à–µ –æ–ø—Ü–∏–π –¥–ª—è horizontal_growth
    )

    # –®–ê–ì 6: üî• –ù–û–í–û–ï: –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–ø–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Å–º–µ–∂–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
    # –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º—ã!
    adjacent_profiles = self._get_adjacent_position_profiles(
        target_path,
        levels_down=1,  # –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–∑–∏—Ü–∏–π –Ω–∏–∂–µ
        levels_up=1     # –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–∑–∏—Ü–∏–π –≤—ã—à–µ
    )

    # –®–ê–ì 7: –ü–æ–ª—É—á–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞
    # (–ù–ï —Å–∂–∏–º–∞–µ–º - —ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–æ–ª–∏)
    functional_context = self._get_departmental_functional_context(target_path)

    # –®–ê–ì 8: –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∫–æ–º–ø–∞–∫—Ç–Ω–∞—è, –¥–ª—è –æ–±—â–µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è)
    org_summary = self._get_organization_summary_compact()

    # –®–ê–ì 9: –°–æ–±–∏—Ä–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–ª—è –ö–ê–ß–ï–°–¢–í–ê
    quality_optimized_structure = {
        "target_unit": target_full_info,  # –ü–û–õ–ù–ê–Ø –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

        "organizational_context": {
            "parent_chain": parent_chain,        # 3 —É—Ä–æ–≤–Ω—è –≤–≤–µ—Ä—Ö
            "children": children_tree,           # 2 —É—Ä–æ–≤–Ω—è –≤–Ω–∏–∑
            "peers": peers,                      # –î–æ 10 peer'–æ–≤
            "functional_description": functional_context  # –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç
        },

        # üî• –ö–õ–Æ–ß–ï–í–û–ï –î–û–ü–û–õ–ù–ï–ù–ò–ï –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞
        "career_context": {
            "description": "–¢–∏–ø–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Å–º–µ–∂–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º—ã",
            "positions_below": adjacent_profiles["below"],   # –û—Ç–∫—É–¥–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç
            "positions_above": adjacent_profiles["above"],   # –ö—É–¥–∞ —Ä–∞—Å—Ç—É—Ç
            "lateral_positions": adjacent_profiles["lateral"] # –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
        },

        "organization_summary": org_summary,

        "quality_metadata": {
            "signal_to_noise_ratio": self._calculate_signal_noise_ratio(
                relevant_units=1 + len(parent_chain) + len(children_tree) + len(peers),
                total_units=567
            ),
            "context_completeness_score": self._validate_context_completeness(
                target_full_info
            ),
            "relevance_score": self._calculate_relevance_score(target_path)
        }
    }

    return quality_optimized_structure
```

#### –ù–æ–≤—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

```python
def _get_target_unit_full_details(
    self,
    unit: Dict[str, Any],
    path: str
) -> Dict[str, Any]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –ü–û–õ–ù–£–Æ –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ü–µ–ª–µ–≤–æ–º –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏.

    –î–ª—è –ö–ê–ß–ï–°–¢–í–ê - –Ω–µ —ç–∫–æ–Ω–æ–º–∏–º –Ω–∞ –¥–µ—Ç–∞–ª—è—Ö —Ü–µ–ª–µ–≤–æ–≥–æ —é–Ω–∏—Ç–∞.
    """
    return {
        "name": unit["name"],
        "full_path": path,
        "level": unit["level"],

        # –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü–∏–π (–ù–ï —Å–æ–∫—Ä–∞—â–∞–µ–º!)
        "positions": unit.get("positions", []),
        "positions_count": len(unit.get("positions", [])),

        # –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö
        "headcount": unit.get("headcount", 0),
        "headcount_source": unit.get("headcount_source", "calculated"),

        # –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        "functional_description": unit.get("description", ""),

        # –ö–ª—é—á–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        "is_department": unit["level"] <= 2,  # –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏–ª–∏ –Ω–∏–∂–µ?
        "has_subordinate_units": len(unit.get("children", {})) > 0,

        # –§–ª–∞–≥ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö
        "data_completeness": {
            "has_positions": len(unit.get("positions", [])) > 0,
            "has_headcount": unit.get("headcount", 0) > 0,
            "has_description": bool(unit.get("description"))
        }
    }


def _get_adjacent_position_profiles(
    self,
    target_path: str,
    levels_down: int = 1,
    levels_up: int = 1
) -> Dict[str, List[Dict[str, Any]]]:
    """
    üî• –ö–†–ò–¢–ò–ß–ù–û –î–õ–Ø –ö–ê–ß–ï–°–¢–í–ê –ö–ê–†–¨–ï–†–û–ì–†–ê–ú–ú–´!

    –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–ø–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Å–º–µ–∂–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–∞—Ä—å–µ—Ä–Ω—ã—Ö –ø—É—Ç–µ–π.

    –ü—Ä–æ–±–ª–µ–º–∞: LLM –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, –∫–∞–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ª–æ–≥–∏—á–Ω—ã –¥–ª—è –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞
    –†–µ—à–µ–Ω–∏–µ: –î–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –≤—ã—à–µ/–Ω–∏–∂–µ/—Ä—è–¥–æ–º

    Args:
        target_path: –ü—É—Ç—å –∫ —Ü–µ–ª–µ–≤–æ–º—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é
        levels_down: –°–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –Ω–∏–∂–µ –∏—Å–∫–∞—Ç—å (source_positions)
        levels_up: –°–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –≤—ã—à–µ –∏—Å–∫–∞—Ç—å (target_pathways)

    Returns:
        {
            "below": [{"position": "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫", "department": "...", "level": 2}, ...],
            "above": [{"position": "–¢–∏–º–ª–∏–¥", "department": "...", "level": 4}, ...],
            "lateral": [{"position": "QA Engineer", "department": "...", "level": 3}, ...]
        }
    """

    path_parts = [p.strip() for p in target_path.split("/") if p.strip()]
    target_level = len(path_parts)

    adjacent_profiles = {
        "below": [],
        "above": [],
        "lateral": []
    }

    # 1. –ü–æ–∑–∏—Ü–∏–∏ –ù–ò–ñ–ï (source_positions –¥–ª—è –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º—ã)
    if levels_down > 0 and target_level > 1:
        # –ò—â–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è—Ö
        target_unit = organization_cache.find_unit_by_path(target_path)
        if target_unit and "children" in target_unit:
            for child_name, child_data in list(target_unit["children"].items())[:3]:
                child_positions = child_data.get("positions", [])
                for pos in child_positions[:2]:  # –¢–æ–ø-2 –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ –∫–∞–∂–¥–æ–≥–æ child
                    adjacent_profiles["below"].append({
                        "position": pos,
                        "department": f"{target_path}/{child_name}",
                        "level": determine_position_level(pos, "numeric"),
                        "category": determine_position_category(pos)
                    })

    # 2. –ü–æ–∑–∏—Ü–∏–∏ –í–´–®–ï (target_pathways –¥–ª—è –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º—ã)
    if levels_up > 0 and target_level < 6:
        # –ò—â–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è—Ö
        parent_path = "/".join(path_parts[:-1]) if len(path_parts) > 1 else None
        if parent_path:
            parent_unit = organization_cache.find_unit_by_path(parent_path)
            if parent_unit:
                parent_positions = parent_unit.get("positions", [])
                for pos in parent_positions[:3]:  # –¢–æ–ø-3 –ø–æ–∑–∏—Ü–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è
                    adjacent_profiles["above"].append({
                        "position": pos,
                        "department": parent_path,
                        "level": determine_position_level(pos, "numeric"),
                        "category": determine_position_category(pos)
                    })

    # 3. –ü–æ–∑–∏—Ü–∏–∏ –†–Ø–î–û–ú (horizontal_growth)
    peers = self._get_peer_units_extended(target_path, max_peers=5)
    for peer in peers:
        # –ü–æ–ª—É—á–∞–µ–º peer unit
        peer_path = f"{'/'.join(path_parts[:-1])}/{peer['name']}"
        peer_unit = organization_cache.find_unit_by_path(peer_path)
        if peer_unit:
            peer_positions = peer_unit.get("positions", [])
            for pos in peer_positions[:2]:  # –¢–æ–ø-2 –∏–∑ –∫–∞–∂–¥–æ–≥–æ peer
                adjacent_profiles["lateral"].append({
                    "position": pos,
                    "department": peer_path,
                    "level": determine_position_level(pos, "numeric"),
                    "category": determine_position_category(pos)
                })

    logger.info(
        f"Adjacent profiles: {len(adjacent_profiles['below'])} below, "
        f"{len(adjacent_profiles['above'])} above, "
        f"{len(adjacent_profiles['lateral'])} lateral"
    )

    return adjacent_profiles


def _get_departmental_functional_context(self, target_path: str) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞.

    –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: "–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –≤ –∫–æ–º–ø–∞–Ω–∏–∏?"

    –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–∑–∏—Ü–∏–∏.
    """
    path_parts = [p.strip() for p in target_path.split("/") if p.strip()]

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç (–æ–±—ã—á–Ω–æ —É—Ä–æ–≤–µ–Ω—å 2)
    main_department = path_parts[1] if len(path_parts) > 1 else path_parts[0]

    # –ö–∞—Ä—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤
    DEPARTMENTAL_FUNCTIONS = {
        "–î–ò–¢": "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–∏—Ñ—Ä–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–∏, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö IT-—Å–∏—Å—Ç–µ–º, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –∏ —Ü–∏—Ñ—Ä–æ–≤—É—é —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤.",

        "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π": "–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–∏—Ñ—Ä–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–∏, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö IT-—Å–∏—Å—Ç–µ–º, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –∏ —Ü–∏—Ñ—Ä–æ–≤—É—é —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤.",

        "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º": "–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ–¥–±–æ—Ä, —Ä–∞–∑–≤–∏—Ç–∏–µ –∏ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∫—É–ª—å—Ç—É—Ä—ã, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º–∏ –∏ –∫–∞—Ä—å–µ—Ä–Ω—ã–º —Ä–æ—Å—Ç–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.",

        "–§–∏–Ω–∞–Ω—Å–æ–≤–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç": "–£–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏ –∫–æ–º–ø–∞–Ω–∏–∏, –≤–µ–¥–µ—Ç –±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫—É—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–æ–≤.",

        "–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç": "–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø—Ä–æ–¥–∞–∂—É –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤, —Ä–∞–∑–≤–∏—Ç–∏–µ –∫–∞–Ω–∞–ª–æ–≤ —Å–±—ã—Ç–∞ –∏ –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—é –≤—ã—Ä—É—á–∫–∏.",

        "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è": "–†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∏ –ø—Ä–æ–µ–∫—Ç–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–æ—Ä–º–∞—Ç–∏–≤–∞–º –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∫–∞—á–µ—Å—Ç–≤–∞.",

        "–°–ª—É–∂–±–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫–∞–∑—á–∏–∫–∞": "–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤, –±—é–¥–∂–µ—Ç–æ–≤ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –∫–∞—á–µ—Å—Ç–≤–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–≤–æ–¥ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é.",

        # –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    }

    # –ò—â–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
    functional_description = DEPARTMENTAL_FUNCTIONS.get(
        main_department,
        f"–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ '{main_department}' –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ä–∞–º–∫–∞—Ö –±–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –ê101."
    )

    # –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–æ–ø-—É—Ä–æ–≤–µ–Ω—å
    if len(path_parts) > 2:
        subdivision = path_parts[-1]
        functional_description += f" –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ '{subdivision}' —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É–∑–∫–æ–ø—Ä–æ—Ñ–∏–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö –≤ —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è."

    return functional_description


def _calculate_signal_noise_ratio(
    self,
    relevant_units: int,
    total_units: int
) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å signal-to-noise ratio –¥–ª—è –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞.

    –¶–µ–ª—å: >= 2:1 (–º–∏–Ω–∏–º—É–º 2 —Ç–æ–∫–µ–Ω–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö –Ω–∞ 1 —Ç–æ–∫–µ–Ω —à—É–º–∞)
    """
    if total_units == 0:
        return 0.0

    # –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —é–Ω–∏—Ç—ã = signal
    # –ù–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —é–Ω–∏—Ç—ã = noise
    noise_units = total_units - relevant_units

    if noise_units == 0:
        return float('inf')  # –ò–¥–µ–∞–ª—å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è - –Ω–µ—Ç —à—É–º–∞

    return relevant_units / noise_units


def _validate_context_completeness(
    self,
    target_info: Dict[str, Any]
) -> float:
    """
    –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ç—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è.

    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
    - Positions (list must exist)
    - Headcount (number > 0)
    - Functional description (optional but recommended)

    Returns:
        Completeness score 0.0 - 1.0
    """
    score = 0.0
    checks = 0

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ï—Å—Ç—å –ª–∏ –ø–æ–∑–∏—Ü–∏–∏?
    if target_info.get("positions_count", 0) > 0:
        score += 0.4  # 40% –≤–µ—Å–∞
    checks += 1

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ï—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –æ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏?
    if target_info.get("headcount", 0) > 0:
        score += 0.3  # 30% –≤–µ—Å–∞
    checks += 1

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ï—Å—Ç—å –ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ?
    if target_info.get("functional_description"):
        score += 0.2  # 20% –≤–µ—Å–∞
    checks += 1

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –ï—Å—Ç—å –ª–∏ –¥–æ—á–µ—Ä–Ω–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (–µ—Å–ª–∏ —É–º–µ—Å—Ç–Ω–æ)?
    if target_info.get("has_subordinate_units"):
        score += 0.1  # 10% –≤–µ—Å–∞
    checks += 1

    return round(score, 2)


def _calculate_relevance_score(self, target_path: str) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å relevance score –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

    –ú–µ—Ç—Ä–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞: –Ω–∞—Å–∫–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è?

    Factors:
    - –¢–æ—á–Ω–æ—Å—Ç—å KPI –¥–ª—è –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ (0.0-0.4)
    - –ù–∞–ª–∏—á–∏–µ adjacent profiles –¥–ª—è –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º—ã (0.0-0.3)
    - –ü–æ–ª–Ω–æ—Ç–∞ organizational context (0.0-0.3)

    Returns:
        Relevance score 0.0 - 1.0 (—Ü–µ–ª—å: >= 0.85)
    """
    score = 0.0

    # Factor 1: KPI relevance (40%)
    department_name = target_path.split("/")[-1]
    has_specific_kpi = self.kpi_mapper.has_specific_kpi_file(department_name)
    if has_specific_kpi:
        score += 0.4
    else:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ generic KPI –¥–ª—è —Ç–∏–ø–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞
        has_generic_kpi = self.kpi_mapper.has_generic_kpi_for_type(department_name)
        if has_generic_kpi:
            score += 0.2  # –ü–æ–ª–æ–≤–∏–Ω–∞ –±–∞–ª–ª–æ–≤ –∑–∞ generic KPI

    # Factor 2: Career context (30%)
    adjacent_profiles = self._get_adjacent_position_profiles(target_path)
    total_adjacent = (
        len(adjacent_profiles["below"]) +
        len(adjacent_profiles["above"]) +
        len(adjacent_profiles["lateral"])
    )
    if total_adjacent >= 5:
        score += 0.3
    elif total_adjacent >= 3:
        score += 0.2
    elif total_adjacent >= 1:
        score += 0.1

    # Factor 3: Organizational context completeness (30%)
    target_unit = organization_cache.find_unit_by_path(target_path)
    if target_unit:
        completeness = self._validate_context_completeness(
            self._get_target_unit_full_details(target_unit, target_path)
        )
        score += 0.3 * completeness

    return round(score, 2)
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ prepare_langfuse_variables():

```python
# –í –º–µ—Ç–æ–¥–µ prepare_langfuse_variables()

# ‚ùå –°–¢–ê–†–´–ô –ö–û–î (focus on economy):
"OrgStructure": json.dumps(
    self._extract_relevant_org_branch(target_path, levels_up=2, levels_down=1),
    ensure_ascii=False, indent=2
),

# ‚úÖ –ù–û–í–´–ô –ö–û–î (focus on QUALITY):
org_structure_quality = self._extract_relevant_org_branch_for_quality(
    target_path=f"{department}/{position}"
)

# –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ü–ï–†–ï–î –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
if org_structure_quality.get("quality_metadata", {}).get("context_completeness_score", 0) < 0.7:
    logger.warning(
        f"Low context completeness score: "
        f"{org_structure_quality['quality_metadata']['context_completeness_score']}"
    )

"OrgStructure": json.dumps(org_structure_quality, ensure_ascii=False, indent=2),

# –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç–∞
"context_quality_metrics": {
    "signal_to_noise_ratio": org_structure_quality["quality_metadata"]["signal_to_noise_ratio"],
    "completeness_score": org_structure_quality["quality_metadata"]["context_completeness_score"],
    "relevance_score": org_structure_quality["quality_metadata"]["relevance_score"]
},
```

#### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ (–¥–ª—è –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è 1):

- ‚úÖ Signal-to-Noise Ratio: >= 2:1 (—Å–µ–π—á–∞—Å 1:30)
- ‚úÖ Context Completeness Score: >= 0.85 (—Å–µ–π—á–∞—Å ~0.6)
- ‚úÖ Relevance Score: >= 0.85 (—Å–µ–π—á–∞—Å ~0.4)
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º—ã: 90% —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø—É—Ç–µ–π

---

## üìã –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï 2: Few-Shot Learning (–ü—Ä–∏–º–µ—Ä—ã –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π)

### –ü—Ä–æ–±–ª–µ–º–∞:
LLM –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç:
- –ö–∞–∫–æ–π —Å—Ç–∏–ª—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –Ω—É–∂–µ–Ω
- –ö–∞–∫–∞—è –≥–ª—É–±–∏–Ω–∞ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è
- –ö–∞–∫ –¥–æ–ª–∂–Ω–∞ –≤—ã–≥–ª—è–¥–µ—Ç—å —Ö–æ—Ä–æ—à–∞—è –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º–∞
- –ö–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –Ω–∞–≤—ã–∫–∞—Ö

### –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å 2-3 —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è

#### –ó–∞–¥–∞—á–∞ 2.1: –°–æ–∑–¥–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π

**–§–∞–π–ª:** `templates/examples/` (–Ω–æ–≤–∞—è –ø–∞–ø–∫–∞)
**–í—Ä–µ–º—è:** 4-6 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

**–ü–æ–¥—Ö–æ–¥:**

```
1. –í—ã–±—Ä–∞—Ç—å 3 best-practice –ø—Ä–æ—Ñ–∏–ª—è –∏–∑ feedback:
   - Executive —É—Ä–æ–≤–µ–Ω—å (–î–∏—Ä–µ–∫—Ç–æ—Ä –î–ò–¢)
   - Senior —É—Ä–æ–≤–µ–Ω—å (–°—Ç–∞—Ä—à–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫ BI)
   - Middle —É—Ä–æ–≤–µ–Ω—å (–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)

2. –ê–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ñ–∏–ª—å:
   - –ü–æ—á–µ–º—É —ç—Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π?
   - –ö–∞–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã –æ—Å–æ–±–µ–Ω–Ω–æ —Ö–æ—Ä–æ—à–∏?
   - –ö–∞–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –Ω—É–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å?

3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–º–ø—Ç:
   - –ù–ï –≤ JSON schema (—Ç–∞–º —É–∂–µ 664 —Å—Ç—Ä–æ–∫–∏)
   - –í separate —Å–µ–∫—Ü–∏—é –ø—Ä–æ–º–ø—Ç–∞ "EXAMPLES"
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ examples:**

```markdown
# templates/examples/executive_example.json
{
  "position_title": "–î–∏—Ä–µ–∫—Ç–æ—Ä –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º",
  "annotation": {
    "quality_score": 9.5,
    "strong_points": [
      "–ß–µ—Ç–∫–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ primary_activity_type",
      "–î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –Ω–∞–≤—ã–∫–∞–º–∏ –¥–ª—è —Ä–æ—Å—Ç–∞",
      "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –≤–ª–∞–¥–µ–Ω–∏—è",
      "KPI –∏–∑–º–µ—Ä–∏–º—ã–µ –∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–ª—è executive —É—Ä–æ–≤–Ω—è"
    ],
    "use_this_profile_for": [
      "Executive positions (CEO-1, CEO-2)",
      "Positions with > 50 subordinates",
      "Strategic leadership roles"
    ]
  },
  "profile": {
    ... –ø–æ–ª–Ω—ã–π JSON –ø—Ä–æ—Ñ–∏–ª—è ...
  }
}

# templates/examples/senior_example.json
# templates/examples/middle_example.json
```

#### –ó–∞–¥–∞—á–∞ 2.2: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤ –ø—Ä–æ–º–ø—Ç

**–§–∞–π–ª:** `templates/prompts/production/prompt.txt`
**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞

**–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é:**

```markdown
# –°–ï–ö–¶–ò–Ø 4: –ü–†–ò–ú–ï–†–´ –ö–ê–ß–ï–°–¢–í–ï–ù–ù–´–• –ü–†–û–§–ò–õ–ï–ô (Few-Shot Learning)

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã 3 —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –æ–∂–∏–¥–∞–µ–º–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å—Ç–∏–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

## –ü—Ä–∏–º–µ—Ä 1: Executive —É—Ä–æ–≤–µ–Ω—å

{{executive_example}}

**–ü–æ—á–µ–º—É —ç—Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π:**
- –ö–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è, —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ skill gaps –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏
- KPI —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ, –∏–∑–º–µ—Ä–∏–º—ã–µ
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —É—Ä–æ–≤–Ω—è–º

## –ü—Ä–∏–º–µ—Ä 2: Senior —É—Ä–æ–≤–µ–Ω—å

{{senior_example}}

**–ü–æ—á–µ–º—É —ç—Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π:**
- –ù–∞–≤—ã–∫–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ
- –ö–∞—Ä—å–µ—Ä–Ω—ã–µ –ø—É—Ç–∏ –ª–æ–≥–∏—á–Ω—ã–µ –∏ –¥–æ—Å—Ç–∏–∂–∏–º—ã–µ
- KPI —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ, —Å–≤—è–∑–∞–Ω—ã —Å daily —Ä–∞–±–æ—Ç–æ–π

## –ü—Ä–∏–º–µ—Ä 3: Middle —É—Ä–æ–≤–µ–Ω—å

{{middle_example}}

**–ü–æ—á–µ–º—É —ç—Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π:**
- –§–æ–∫—É—Å –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞–≤—ã–∫–∞—Ö
- Source positions —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ
- –ö–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç —á–µ—Ç–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω

---

**–¢–í–û–Ø –ó–ê–î–ê–ß–ê:**
–ì–µ–Ω–µ—Ä–∏—Ä—É–π –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è {{position}} –≤ —Å—Ç–∏–ª–µ –∏ –∫–∞—á–µ—Å—Ç–≤–µ, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–º –ø—Ä–∏–º–µ—Ä–∞–º –≤—ã—à–µ.
–ê–¥–∞–ø—Ç–∏—Ä—É–π —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Å—Ç–∏–ª—å –ø–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ–∑–∏—Ü–∏–∏.
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ DataLoader:

```python
def _load_few_shot_examples(self, position_category: str) -> str:
    """
    –ó–∞–≥—Ä—É–∑–∏—Ç—å few-shot –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞.

    Args:
        position_category: –ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞

    Returns:
        Formatted examples –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
    """
    examples_dir = Path("templates/examples")

    # –í—ã–±–∏—Ä–∞–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    if "–≤—ã—Å—à–µ–≥–æ —É—Ä–æ–≤–Ω—è" in position_category.lower() or "executive" in position_category.lower():
        example_file = examples_dir / "executive_example.json"
    elif "—Å—Ä–µ–¥–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è" in position_category.lower() or "senior" in position_category.lower():
        example_file = examples_dir / "senior_example.json"
    else:
        example_file = examples_dir / "middle_example.json"

    # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–º–µ—Ä
    with open(example_file, "r", encoding="utf-8") as f:
        example_data = json.load(f)

    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
    formatted_example = f"""
### –≠—Ç–∞–ª–æ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å ({example_data['position_title']})

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã —ç—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è:**
{chr(10).join(f"- {point}" for point in example_data['annotation']['strong_points'])}

**–ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å:**
```json
{json.dumps(example_data['profile'], ensure_ascii=False, indent=2)}
```
"""

    return formatted_example
```

#### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ (–¥–ª—è –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è 2):

- ‚úÖ –°—Ç–∏–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–º–µ—Ä–∞–º (manual review)
- ‚úÖ Completeness score: >= 0.90 (—Å–µ–π—á–∞—Å ~0.75)
- ‚úÖ –ì–ª—É–±–∏–Ω–∞ –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º—ã: 100% –ø–æ–∑–∏—Ü–∏–π —Å skill gaps

---

## üìã –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï 3: Pre-Flight –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞:
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ –¥–∞–∂–µ –∫–æ–≥–¥–∞:
- KPI –¥–ª—è –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ = 0
- –ü–æ–∑–∏—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ–ø–æ–ª–Ω—ã–π

–†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤—ã—Ö–æ–¥–∞

### –†–µ—à–µ–Ω–∏–µ: –í–∞–ª–∏–¥–∞—Ü–∏—è –î–û –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

#### –ó–∞–¥–∞—á–∞ 3.1: –°–æ–∑–¥–∞—Ç—å Context Validator

**–§–∞–π–ª:** `backend/core/context_validator.py` (–Ω–æ–≤—ã–π)
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í–´–°–û–ö–ò–ô

```python
"""
Context Validator - Pre-flight –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.

–¶–µ–ª—å: –ù–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ —Å –ø–ª–æ—Ö–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.
–õ—É—á—à–µ —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É, —á–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å.
"""

from typing import Dict, Any, List
from dataclasses import dataclass
import logging

logger = logging.getLogger(__name__)


@dataclass
class ValidationResult:
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
    is_valid: bool
    errors: List[str]
    warnings: List[str]
    quality_score: float  # 0.0 - 1.0
    recommendation: str


class ContextValidator:
    """
    –í–∞–ª–∏–¥–∞—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø—Ä–æ—Ñ–∏–ª—è.

    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
    1. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
    2. KPI –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–ª—è –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞
    3. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–∞—è
    4. –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ —Ä–∞–∑—É–º–Ω–∞—è
    5. Signal-to-noise ratio –ø—Ä–∏–µ–º–ª–µ–º—ã–π
    """

    # –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞
    MIN_QUALITY_SCORE = 0.70  # –ú–∏–Ω–∏–º—É–º –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    OPTIMAL_QUALITY_SCORE = 0.85  # –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ

    def validate_context(
        self,
        variables: Dict[str, Any]
    ) -> ValidationResult:
        """
        –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.

        Args:
            variables: –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Langfuse

        Returns:
            ValidationResult —Å –æ—Ü–µ–Ω–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞
        """
        errors = []
        warnings = []
        checks_passed = 0
        total_checks = 0

        # ============== CRITICAL CHECKS ==============

        # Check 1: –ü–æ–∑–∏—Ü–∏—è —É–∫–∞–∑–∞–Ω–∞
        total_checks += 1
        if not variables.get("position"):
            errors.append("–ö—Ä–∏—Ç–∏—á–Ω–æ: –ü–æ–∑–∏—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞")
        else:
            checks_passed += 1

        # Check 2: –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —É–∫–∞–∑–∞–Ω
        total_checks += 1
        if not variables.get("department"):
            errors.append("–ö—Ä–∏—Ç–∏—á–Ω–æ: –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –Ω–µ —É–∫–∞–∑–∞–Ω")
        else:
            checks_passed += 1

        # Check 3: JSON Schema –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
        total_checks += 1
        if not variables.get("json_schema"):
            errors.append("–ö—Ä–∏—Ç–∏—á–Ω–æ: JSON Schema –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")
        else:
            checks_passed += 1

        # Check 4: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
        total_checks += 1
        org_structure = variables.get("OrgStructure")
        if not org_structure or org_structure == "{}":
            errors.append("–ö—Ä–∏—Ç–∏—á–Ω–æ: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")
        else:
            checks_passed += 1
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            self._validate_org_structure_quality(
                org_structure, errors, warnings
            )

        # ============== QUALITY CHECKS ==============

        # Check 5: KPI –¥–∞–Ω–Ω—ã–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ
        total_checks += 1
        kpi_data = variables.get("kpi_data", "")
        if "–î–ò–¢" in kpi_data and variables["department"] != "–î–ò–¢":
            warnings.append(
                f"–í–Ω–∏–º–∞–Ω–∏–µ: KPI –¥–∞–Ω–Ω—ã–µ –æ—Ç –î–ò–¢ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ '{variables['department']}'"
            )
        elif kpi_data and kpi_data != "[–ù–ï–¢ –î–ê–ù–ù–´–•]":
            checks_passed += 1

        # Check 6: –ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ —Ä–∞–∑—É–º–Ω–∞—è
        total_checks += 1
        headcount = variables.get("department_headcount", 0)
        if headcount == 0:
            warnings.append("–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞")
        elif headcount < 0:
            errors.append(f"–û—à–∏–±–∫–∞: –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å ({headcount})")
        elif headcount > 1000:
            warnings.append(f"–í–Ω–∏–º–∞–Ω–∏–µ: –ë–æ–ª—å—à–∞—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ ({headcount})")
            checks_passed += 1
        else:
            checks_passed += 1

        # Check 7: Signal-to-noise ratio –ø—Ä–∏–µ–º–ª–µ–º—ã–π
        total_checks += 1
        context_metrics = variables.get("context_quality_metrics", {})
        snr = context_metrics.get("signal_to_noise_ratio", 0)
        if snr < 0.5:
            warnings.append(f"–ù–∏–∑–∫–∏–π Signal-to-Noise Ratio: {snr:.2f} (—Ü–µ–ª—å: >= 2.0)")
        elif snr >= 2.0:
            checks_passed += 1

        # Check 8: Completeness score –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π
        total_checks += 1
        completeness = context_metrics.get("completeness_score", 0)
        if completeness < 0.6:
            warnings.append(f"–ù–∏–∑–∫–∞—è –ø–æ–ª–Ω–æ—Ç–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: {completeness:.2f}")
        elif completeness >= 0.85:
            checks_passed += 1

        # ============== –í–´–ß–ò–°–õ–ï–ù–ò–ï –ò–¢–û–ì–û–í–û–ô –û–¶–ï–ù–ö–ò ==============

        quality_score = checks_passed / total_checks if total_checks > 0 else 0.0

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
        is_valid = len(errors) == 0 and quality_score >= self.MIN_QUALITY_SCORE

        # –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é
        if not is_valid:
            if errors:
                recommendation = "–ë–õ–û–ö–ò–†–û–í–ê–¢–¨: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞."
            else:
                recommendation = f"–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∏–∑–∫–æ–µ ({quality_score:.0%}). –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–ª—É—á—à–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π."
        elif quality_score >= self.OPTIMAL_QUALITY_SCORE:
            recommendation = "–û–¢–õ–ò–ß–ù–û: –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞. –ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å."
        else:
            recommendation = f"–•–û–†–û–®–û: –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏–µ–º–ª–µ–º–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ ({quality_score:.0%}). –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–∞."

        return ValidationResult(
            is_valid=is_valid,
            errors=errors,
            warnings=warnings,
            quality_score=quality_score,
            recommendation=recommendation
        )

    def _validate_org_structure_quality(
        self,
        org_structure: str,
        errors: List[str],
        warnings: List[str]
    ):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã"""
        try:
            org_data = json.loads(org_structure) if isinstance(org_structure, str) else org_structure

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ target_unit
            if "target_unit" not in org_data:
                errors.append("–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç target_unit")
                return

            target = org_data["target_unit"]

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º positions
            if not target.get("positions"):
                warnings.append("–¶–µ–ª–µ–≤–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–∫–∞ –ø–æ–∑–∏—Ü–∏–π")

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º headcount
            if target.get("headcount", 0) == 0:
                warnings.append("–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞")

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º career_context (–¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º—ã)
            if "career_context" in org_data:
                career = org_data["career_context"]
                total_adjacent = (
                    len(career.get("positions_below", [])) +
                    len(career.get("positions_above", [])) +
                    len(career.get("lateral_positions", []))
                )
                if total_adjacent == 0:
                    warnings.append("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç adjacent positions –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º—ã")
                elif total_adjacent < 3:
                    warnings.append(f"–ú–∞–ª–æ adjacent positions ({total_adjacent}) –¥–ª—è –∫–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º—ã")

        except json.JSONDecodeError:
            errors.append("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã")
        except Exception as e:
            errors.append(f"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: {str(e)}")


# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
context_validator = ContextValidator()
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ ProfileGenerator:

```python
# –í –º–µ—Ç–æ–¥–µ generate_profile() –≤ profile_generator.py

async def generate_profile(
    self,
    department: str,
    position: str,
    ...
) -> Dict[str, Any]:
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Å pre-flight –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π"""

    # 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    variables = self.data_loader.prepare_langfuse_variables(
        department=department,
        position=position,
        employee_name=employee_name
    )

    # üî• 2. –ù–û–í–û–ï: Pre-flight –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    from backend.core.context_validator import context_validator

    validation = context_validator.validate_context(variables)

    logger.info(
        f"Context validation: quality={validation.quality_score:.2%}, "
        f"errors={len(validation.errors)}, warnings={len(validation.warnings)}"
    )

    # –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
    for warning in validation.warnings:
        logger.warning(f"Context validation: {warning}")

    # –ï—Å–ª–∏ –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ - –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º
    if not validation.is_valid:
        logger.error(f"Context validation FAILED: {validation.recommendation}")

        return {
            "success": False,
            "profile": None,
            "metadata": {
                "generation": {...},
                "validation": {
                    "is_valid": False,
                    "quality_score": validation.quality_score,
                    "errors": validation.errors,
                    "warnings": validation.warnings,
                    "recommendation": validation.recommendation
                }
            },
            "errors": validation.errors,
            "warnings": validation.warnings
        }

    # –ï—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∏–∑–∫–æ–µ –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º
    if validation.quality_score < ContextValidator.OPTIMAL_QUALITY_SCORE:
        logger.warning(
            f"Context quality below optimal: {validation.quality_score:.0%}. "
            f"Recommendation: {validation.recommendation}"
        )

    # 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ LLM (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞)
    llm_result = await self.llm_client.generate_profile_from_langfuse(...)

    ...
```

#### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ (–¥–ª—è –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è 3):

- ‚úÖ 0% –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Å –∫—Ä–∏—Ç–∏—á–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- ‚úÖ 90%+ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Å quality_score >= 0.85
- ‚úÖ –í—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

---

## üìã –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï 4: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ KPI –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞ (–ö–†–ò–¢–ò–ß–ù–û!):
**98.4% –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ï KPI**

```
–°–µ–π—á–∞—Å: 9 –∏–∑ 567 –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ –∏–º–µ—é—Ç —Å–≤–æ–∏ KPI
        558 –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç KPI –æ—Ç –î–ò–¢ (fallback)

–†–µ–∑—É–ª—å—Ç–∞—Ç: "–ë–ª–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏" –∏–∑–º–µ—Ä—è–µ—Ç—Å—è KPI –¥–ª—è IT –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ ‚ùå
```

### –†–µ—à–µ–Ω–∏–µ: Generic KPI + Department Type Mapping

#### –ó–∞–¥–∞—á–∞ 4.1: –°–æ–∑–¥–∞—Ç—å Generic KPI Templates

**–§–∞–π–ª:** `backend/core/kpi_templates.py` (–Ω–æ–≤—ã–π)
**–í—Ä–µ–º—è:** 6-8 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

```python
"""
Generic KPI Templates –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤.

–§–∏–ª–æ—Å–æ—Ñ–∏—è: –õ—É—á—à–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π generic KPI, —á–µ–º –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π specific KPI.
"""

from typing import Dict, List
from enum import Enum


class DepartmentType(Enum):
    """–¢–∏–ø—ã –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏ –ê101"""
    IT = "it"
    HR = "hr"
    FINANCE = "finance"
    COMMERCIAL = "commercial"
    CONSTRUCTION = "construction"
    LEGAL = "legal"
    SECURITY = "security"
    DESIGN = "design"
    PROCUREMENT = "procurement"
    MARKETING = "marketing"
    OPERATIONS = "operations"
    ANALYTICS = "analytics"
    UNKNOWN = "unknown"


# Generic KPI –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞
GENERIC_KPI_TEMPLATES = {
    DepartmentType.IT: """
# KPI –¥–ª—è IT –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞

## –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **Availability (SLA)**: –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö IT —Å–∏—Å—Ç–µ–º >= 99.5%
2. **–í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã**:
   - P1 (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ): < 15 –º–∏–Ω—É—Ç
   - P2 (–≤—ã—Å–æ–∫–∏–µ): < 1 —á–∞—Å–∞
   - P3 (—Å—Ä–µ–¥–Ω–∏–µ): < 4 —á–∞—Å–æ–≤
3. **–ü—Ä–æ—Ü–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä—É—Ç–∏–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (—Ü–µ–ª—å: 80%)
4. **–°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: Velocity –∫–æ–º–∞–Ω–¥—ã (story points –∑–∞ —Å–ø—Ä–∏–Ω—Ç)
5. **–í—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è —Å–∏—Å—Ç–µ–º**: < 2 —á–∞—Å–æ–≤/–º–µ—Å—è—Ü –¥–ª—è production —Å–∏—Å—Ç–µ–º

## –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: NPS >= 8/10 –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –æ–ø—Ä–æ—Å–æ–≤
2. **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: Code coverage >= 80%, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ critical bugs
3. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ security —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º**: 100% compliance —Å –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ >= 95%

## –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–¶–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
2. **–ò–Ω–Ω–æ–≤–∞—Ü–∏–∏**: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π (—Ü–µ–ª—å: 2-3 –ø—Ä–æ–µ–∫—Ç–∞/–≥–æ–¥)
3. **ROI IT –ø—Ä–æ–µ–∫—Ç–æ–≤**: –û–∫—É–ø–∞–µ–º–æ—Å—Ç—å IT –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
""",

    DepartmentType.HR: """
# KPI –¥–ª—è HR –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞

## –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **Time to hire**: –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏ <= 30 –¥–Ω–µ–π
2. **Retention rate**: –£–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ >= 90%
3. **–ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç–∏—è –≤–∞–∫–∞–Ω—Å–∏–π**: >= 95% –≤–∞–∫–∞–Ω—Å–∏–π –∑–∞–∫—Ä—ã—Ç–æ –≤ —Å—Ä–æ–∫
4. **eNPS (employee Net Promoter Score)**: >= 30
5. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è**: >= 95% —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—Ä–æ—à–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ

## –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞–π–º–∞**: –£—Å–ø–µ—à–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –∏—Å–ø—ã—Ç–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Å—Ä–æ–∫–∞ >= 90%
2. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏**: –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –Ω–æ–≤–∏—á–∫–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ >= 8/10
3. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É**: 100% compliance —Å –¢—Ä—É–¥–æ–≤—ã–º –∫–æ–¥–µ–∫—Å–æ–º –†–§
4. **–†–∞–∑–≤–∏—Ç–∏–µ —Ç–∞–ª–∞–Ω—Ç–æ–≤**: –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ >= 60%

## –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–¥—Ä–æ–≤–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–∞**: –ü–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –Ω–∞ 100%
2. **HR –±—Ä–µ–Ω–¥**: –ü–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–π
3. **–°–Ω–∏–∂–µ–Ω–∏–µ HR —Ä–∞—Å—Ö–æ–¥–æ–≤**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –ø–æ–¥–±–æ—Ä –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—é
""",

    DepartmentType.FINANCE: """
# KPI –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞

## –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–¢–æ—á–Ω–æ—Å—Ç—å –±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –ø–ª–∞–Ω–∞ <= 5%
2. **–°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏**: 100% –æ—Ç—á–µ—Ç–æ–≤ —Å–¥–∞–Ω—ã –≤ —Å—Ä–æ–∫
3. **–û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å –¥–µ–±–∏—Ç–æ—Ä—Å–∫–æ–π –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏**: <= 45 –¥–Ω–µ–π
4. **Cash Flow Management**: –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫ >= 95% –ø–µ—Ä–∏–æ–¥–æ–≤
5. **ROI –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π**: –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è >= —Ü–µ–ª–µ–≤–æ–π

## –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–ö–∞—á–µ—Å—Ç–≤–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –æ—Ç—á–µ—Ç–∞—Ö
2. **Compliance**: 100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ú–°–§–û –∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§
3. **–ê—É–¥–∏—Ç**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–º–µ—á–∞–Ω–∏–π –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∞—É–¥–∏—Ç–æ—Ä–æ–≤
4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞–ª–æ–≥–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏**: –í —Ä–∞–º–∫–∞—Ö –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞

## –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏ –ø–ª–∞—Ç–µ–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
2. **–°–Ω–∏–∂–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–∏—Å–∫–æ–≤**: –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–¶–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
""",

    DepartmentType.COMMERCIAL: """
# KPI –¥–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞

## –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø—Ä–æ–¥–∞–∂**: >= 100% –æ—Ç —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
2. **–ö–æ–Ω–≤–µ—Ä—Å–∏—è –ª–∏–¥–æ–≤**: >= 15% –æ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π –¥–æ —Å–¥–µ–ª–∫–∏
3. **–°—Ä–µ–¥–Ω–∏–π —á–µ–∫ —Å–¥–µ–ª–∫–∏**: –†–æ—Å—Ç –Ω–∞ X% –≥–æ–¥ –∫ –≥–æ–¥—É
4. **–°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤/–º–µ—Å—è—Ü
5. **LTV –∫–ª–∏–µ–Ω—Ç–∞**: Lifetime Value >= —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è

## –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤**: NPS >= 50, CSAT >= 4.5/5
2. **–ö–∞—á–µ—Å—Ç–≤–æ –ª–∏–¥–æ–≤**: –î–æ–ª—è –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–∏–¥–æ–≤ >= 70%
3. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏**: >= 20% –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–æ–≤–µ—Ä—à–∞—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø–æ–∫—É–ø–∫—É
4. **Reputation management**: –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∫–æ–º–ø–∞–Ω–∏–∏ >= 4.5/5

## –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑—ã**: –ü—Ä–∏—Ä–æ—Å—Ç –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ +X%/–≥–æ–¥
2. **–î–æ–ª—è —Ä—ã–Ω–∫–∞**: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–æ–ª–∏ –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —Ä—ã–Ω–∫–µ
3. **Digital sales**: –î–æ–ª—è –æ–Ω–ª–∞–π–Ω-–ø—Ä–æ–¥–∞–∂ >= X%
""",

    DepartmentType.SECURITY: """
# KPI –¥–ª—è –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ X% –≥–æ–¥ –∫ –≥–æ–¥—É
2. **–í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã**:
   - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ: < 5 –º–∏–Ω—É—Ç
   - –í—ã—Å–æ–∫–∏–µ: < 15 –º–∏–Ω—É—Ç
   - –°—Ä–µ–¥–Ω–∏–µ: < 1 —á–∞—Å–∞
3. **–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–Ω—ã—Ö —É–≥—Ä–æ–∑**: >= 95%
4. **Compliance —Å —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏**: 100%

## –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–π
2. **–ö—É–ª—å—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: >= 90% —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—Ä–æ—à–ª–∏ –æ–±—É—á–µ–Ω–∏–µ
3. **–ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫**: –í—ã—è–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤ –Ω–∞ —ç—Ç–∞–ø–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤**: –ù–æ–ª—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –≤ –ø—É–±–ª–∏—á–Ω–æ–º –ø–æ–ª–µ

## –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–Ω–∏–∂–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-—Ä–∏—Å–∫–æ–≤
2. **–ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
3. **–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ —Å –ø—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ—Ä–≥–∞–Ω–∞–º–∏**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
""",

    # –î–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤...
}


# –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞–∑–≤–∞–Ω–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Ç–∏–ø—ã
DEPARTMENT_TYPE_MAPPING = {
    # IT –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã
    "–î–ò–¢": DepartmentType.IT,
    "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π": DepartmentType.IT,
    "–û—Ç–¥–µ–ª —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏–∏": DepartmentType.IT,
    "–î–∏—Ä–µ–∫—Ü–∏—è –ø–æ —Ü–∏—Ñ—Ä–æ–≤–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏": DepartmentType.IT,

    # HR –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã
    "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º": DepartmentType.HR,
    "–û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤": DepartmentType.HR,
    "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º": DepartmentType.HR,

    # Finance –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã
    "–§–∏–Ω–∞–Ω—Å–æ–≤–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç": DepartmentType.FINANCE,
    "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤": DepartmentType.FINANCE,
    "–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è": DepartmentType.FINANCE,
    "–ö–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ": DepartmentType.FINANCE,

    # Commercial –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã
    "–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç": DepartmentType.COMMERCIAL,
    "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –ø—Ä–æ–¥–∞–∂": DepartmentType.COMMERCIAL,
    "–û—Ç–¥–µ–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞": DepartmentType.MARKETING,

    # Security –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã
    "–ë–ª–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏": DepartmentType.SECURITY,
    "–°–ª—É–∂–±–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏": DepartmentType.SECURITY,
    "–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏": DepartmentType.SECURITY,

    # ... –¥–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã
}


def get_kpi_for_department(department_name: str) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å KPI –¥–ª—è –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ (specific –∏–ª–∏ generic).

    Priority:
    1. Specific KPI file (if exists)
    2. Generic KPI by department type
    3. Universal fallback KPI

    Args:
        department_name: –ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞

    Returns:
        KPI content (markdown)
    """
    # 1. –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å specific KPI
    specific_kpi = _load_specific_kpi(department_name)
    if specific_kpi:
        return specific_kpi

    # 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞
    dept_type = DEPARTMENT_TYPE_MAPPING.get(department_name, DepartmentType.UNKNOWN)

    # 3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º generic KPI –¥–ª—è —Ç–∏–ø–∞
    if dept_type != DepartmentType.UNKNOWN:
        return GENERIC_KPI_TEMPLATES.get(dept_type, _get_universal_fallback_kpi())

    # 4. Universal fallback
    return _get_universal_fallback_kpi()


def _get_universal_fallback_kpi() -> str:
    """Universal fallback KPI –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤"""
    return """
# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ KPI –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏

## –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á**: >= 95% –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å—Ä–æ–∫
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤/–ø–ª–∞–Ω–æ–≤ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
3. **–°–æ–±–ª—é–¥–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–æ–≤**: <= 5% –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

## –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
1. **–ö–∞—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ –∑–∞–º–µ—á–∞–Ω–∏–π
2. **–°–æ–±–ª—é–¥–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤**: 100% compliance —Å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞–º–∏
3. **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∫–æ–ª–ª–µ–≥–∞–º–∏**: –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

## –†–∞–∑–≤–∏—Ç–∏–µ:
1. **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç**: –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
2. **–í–∫–ª–∞–¥ –≤ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**: –í–Ω–µ—Å–µ–Ω–∏–µ —Ä–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
"""
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ KPI Mapper:

```python
# –û–±–Ω–æ–≤–∏—Ç—å backend/core/kpi_department_mapping.py

from .kpi_templates import get_kpi_for_department

def load_kpi_content(self, department: str) -> str:
    """
    –ó–∞–≥—Ä—É–∑–∫–∞ KPI —Å priority:
    1. Specific file
    2. Generic by type
    3. Universal fallback
    """
    return get_kpi_for_department(department)
```

#### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ (–¥–ª—è –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è 4):

- ‚úÖ 100% –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ KPI (—Å–µ–π—á–∞—Å 1.6%)
- ‚úÖ 0% —Å–ª—É—á–∞–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è IT KPI –¥–ª—è non-IT –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ KPI –º–µ—Ç—Ä–∏–∫: >= 8/10 –ø–æ –æ—Ü–µ–Ω–∫–µ HR

---

## üìã –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï 5: –£–ø—Ä–æ—â–µ–Ω–∏–µ JSON Schema

### –ü—Ä–æ–±–ª–µ–º–∞:
**JSON Schema = 664 —Å—Ç—Ä–æ–∫–∏** —Å –∏–∑–±—ã—Ç–æ—á–Ω—ã–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏

LLM —Ç—Ä–∞—Ç–∏—Ç attention –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ö–µ–º—ã –≤–º–µ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### –†–µ—à–µ–Ω–∏–µ: –°–∂–∞—Ç–∞—è schema + –≤—ã–Ω–æ—Å –ø—Ä–∏–º–µ—Ä–æ–≤

#### –ó–∞–¥–∞—á–∞ 5.1: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é —Å—Ö–µ–º—ã

**–§–∞–π–ª:** `templates/job_profile_schema_compact.json`
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –°–†–ï–î–ù–ò–ô

**–ü–æ–¥—Ö–æ–¥:**
1. –£–±—Ä–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è (–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –ø—Ä–æ–º–ø—Ç)
2. –£–±—Ä–∞—Ç—å enum —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ (–∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ validation –≤ –∫–æ–¥–µ)
3. –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ required fields

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 664 —Å—Ç—Ä–æ–∫–∏ ‚Üí ~200 —Å—Ç—Ä–æ–∫

#### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ (–¥–ª—è –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è 5):

- ‚úÖ Schema size: < 250 —Å—Ç—Ä–æ–∫ (—Å–µ–π—á–∞—Å 664)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ schema: < 1 —Å–µ–∫—É–Ω–¥–∞
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: –Ω–µ —É—Ö—É–¥—à–∞–µ—Ç—Å—è

---

## üìä –°—É–º–º–∞—Ä–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –ö–ê–ß–ï–°–¢–í–û

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|---------|----------|--------|
| –û–±—â–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ñ–∏–ª–µ–π | 7/10 | ‚ö†Ô∏è –ü—Ä–∏–µ–º–ª–µ–º–æ |
| Relevance Score | 0.40 | ‚ùå –ù–∏–∑–∫–∏–π |
| Completeness Score | 0.75 | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π |
| Signal-to-Noise Ratio | 1:30 | ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ |
| KPI Accuracy | 1.6% | ‚ùå –ù–µ–ø—Ä–∏–µ–º–ª–µ–º–æ |
| –ö–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º–∞ –∫–∞—á–µ—Å—Ç–≤–æ | 60% | ‚ö†Ô∏è –ù–∏–∑–∫–æ–µ |

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π (–ø—Ä–æ–≥–Ω–æ–∑):

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----------|--------|-----------|
| –û–±—â–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ñ–∏–ª–µ–π | 9/10 | ‚úÖ –û—Ç–ª–∏—á–Ω–æ | +29% |
| Relevance Score | 0.90 | ‚úÖ –í—ã—Å–æ–∫–∏–π | +125% |
| Completeness Score | 0.92 | ‚úÖ –í—ã—Å–æ–∫–∏–π | +23% |
| Signal-to-Noise Ratio | 2.5:1 | ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ | +7400% |
| KPI Accuracy | 100% | ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ | +6150% |
| –ö–∞—Ä—å–µ—Ä–æ–≥—Ä–∞–º–º–∞ –∫–∞—á–µ—Å—Ç–≤–æ | 95% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ | +58% |

---

## üóìÔ∏è –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ—ç—Ç–∞–ø–Ω—ã–π)

### –≠–¢–ê–ü 1: Quick Wins (–ù–µ–¥–µ–ª—è 1-2) - –§—É–Ω–¥–∞–º–µ–Ω—Ç –∫–∞—á–µ—Å—Ç–≤–∞

**–î–µ–Ω—å 1-3: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4 (KPI Templates)**
- –°–æ–∑–¥–∞—Ç—å generic KPI templates –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤
- –û–±–Ω–æ–≤–∏—Ç—å KPI mapper —Å priority logic
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 20 —Ä–∞–∑–Ω—ã—Ö –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞—Ö

**–î–µ–Ω—å 4-7: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2 (Few-Shot Examples)**
- –í—ã–±—Ä–∞—Ç—å 3 best-practice –ø—Ä–æ—Ñ–∏–ª—è
- –°–æ–∑–¥–∞—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–º–ø—Ç

**–î–µ–Ω—å 8-10: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3 (Pre-Flight Validation)**
- –°–æ–∑–¥–∞—Ç—å Context Validator
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ ProfileGenerator
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≠—Ç–∞–ø–∞ 1:**
- KPI accuracy: 1.6% ‚Üí 100% (+6150%)
- –ö–∞—á–µ—Å—Ç–≤–æ: 7/10 ‚Üí 8/10 (+14%)
- –í—Å–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é

---

### –≠–¢–ê–ü 2: Deep Quality (–ù–µ–¥–µ–ª—è 3-4) - –ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è

**–î–µ–Ω—å 11-16: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1 (–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)**
- –°–æ–∑–¥–∞—Ç—å _extract_relevant_org_branch_for_quality()
- –î–æ–±–∞–≤–∏—Ç—å _get_adjacent_position_profiles()
- –î–æ–±–∞–≤–∏—Ç—å _get_departmental_functional_context()
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ prepare_langfuse_variables()

**–î–µ–Ω—å 17-20: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 5 (Schema Optimization)**
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é schema
- –í—ã–Ω–µ—Å—Ç–∏ –ø—Ä–∏–º–µ—Ä—ã –≤ –ø—Ä–æ–º–ø—Ç
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≠—Ç–∞–ø–∞ 2:**
- Signal-to-Noise: 1:30 ‚Üí 2.5:1 (+7400%)
- Relevance Score: 0.40 ‚Üí 0.90 (+125%)
- –ö–∞—á–µ—Å—Ç–≤–æ: 8/10 ‚Üí 9/10 (+12.5%)

---

### –≠–¢–ê–ü 3: Validation & Tuning (–ù–µ–¥–µ–ª—è 5)

**–î–µ–Ω—å 21-23: –ú–∞—Å—Å–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 100 –ø—Ä–æ—Ñ–∏–ª–µ–π —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
- –°—Ä–∞–≤–Ω–∏—Ç—å —Å —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π (A/B test)
- –°–æ–±—Ä–∞—Ç—å feedback –æ—Ç HR

**–î–µ–Ω—å 24-25: Fine-tuning**
- –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ feedback
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≠—Ç–∞–ø–∞ 3:**
- HR satisfaction: 9/10
- –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ >= —Ü–µ–ª–µ–≤—ã—Ö
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

- [ ] –í—Å–µ 5 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] 100 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ
- [ ] A/B —Ç–µ—Å—Ç –ø–æ–∫–∞–∑–∞–ª —É–ª—É—á—à–µ–Ω–∏–µ >= 20%
- [ ] HR approval –ø–æ–ª—É—á–µ–Ω (–æ—Ü–µ–Ω–∫–∞ >= 8.5/10)
- [ ] –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ >= —Ü–µ–ª–µ–≤—ã—Ö:
  - [ ] Relevance Score >= 0.85
  - [ ] Completeness Score >= 0.90
  - [ ] Signal-to-Noise >= 2:1
  - [ ] KPI Accuracy = 100%
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] Rollback –ø–ª–∞–Ω —Å–æ–∑–¥–∞–Ω
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

---

## üö® –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: Few-shot examples –º–æ–≥—É—Ç –ø–µ—Ä–µ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (Executive/Senior/Middle)
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å/–±–µ–∑ –ø—Ä–∏–º–µ—Ä–æ–≤
- –í–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–∑–∏—Ü–∏–π

### –†–∏—Å–∫ 2: –í–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ª–µ–≥–∏—Ç–∏–º–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ú—è–≥–∫–∏–µ –ø–æ—Ä–æ–≥–∏ (MIN_QUALITY = 0.70, not 0.90)
- Warnings –≤–º–µ—Å—Ç–æ Errors –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- Manual override –¥–ª—è HR —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤

### –†–∏—Å–∫ 3: Generic KPI –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–º–∏

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –î–µ—Ç–∞–ª—å–Ω—ã–µ templates –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è specific KPI –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤
- –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ templates –Ω–∞ –æ—Å–Ω–æ–≤–µ feedback

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Production)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:

- **Context Quality Score**: avg >= 0.85
- **Pre-flight Validation Pass Rate**: >= 95%
- **Signal-to-Noise Ratio**: avg >= 2.0
- **Generation Time**: <= 10 —Å–µ–∫—É–Ω–¥

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

- **HR Satisfaction Score**: >= 8.5/10
- **Profile Completeness**: >= 0.90
- **KPI Relevance**: >= 95% (manual review)
- **Careerogram Quality**: >= 90% —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø—É—Ç–µ–π

### –ë–∏–∑–Ω–µ—Å –º–µ—Ç—Ä–∏–∫–∏:

- **Manual Corrections**: < 10% –ø—Ä–æ—Ñ–∏–ª–µ–π —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤–∫–∏
- **Time to Deploy**: –ü—Ä–æ—Ñ–∏–ª—å –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —á–µ—Ä–µ–∑ <= 1 –¥–µ–Ω—å
- **HR Productivity**: +50% —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π

---

## üí¨ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–¥–µ–∏ (Backlog)

### Idea 1: Reinforcement Learning from HR Feedback
- –°–æ–±–∏—Ä–∞—Ç—å feedback –æ—Ç HR –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ—Ñ–∏–ª—é (1-10)
- –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Å–ø–µ—à–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### Idea 2: –ü—Ä–æ—Ñ–∏–ª—å-to-–ø—Ä–æ—Ñ–∏–ª—å consistency
- –ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞
- –û–±–µ—Å–ø–µ—á–∏—Ç—å consistency –≤ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ –∏ —Å—Ç–∏–ª–µ

### Idea 3: Multi-modal –ø—Ä–æ—Ñ–∏–ª–∏
- –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—ã (–∫–∞—Ä—å–µ—Ä–Ω–æ–µ –¥–µ—Ä–µ–≤–æ, skill matrix)
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è KPI

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
**–§–æ–∫—É—Å:** –ö–ê–ß–ï–°–¢–í–û > –≠–∫–æ–Ω–æ–º–∏—è
**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** Better context beats bigger context
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-25
**–í–µ—Ä—Å–∏—è:** 2.0 (Quality-First Approach)

# Чеклист Улучшений для Промпта Генерации Профилей

**Источник:** `/home/yan/A101/HR/docs/analysis/REFERENCE_VS_GENERATED_COMPARISON.md`
**Дата:** 26 октября 2025

---

## Критичные улучшения (Приоритет 1)

### 1.1 Увеличить количество обязанностей

- [x] **Проанализировать текущее:** 15 задач вместо 21
- [x] **Определить целевое:** 21-25 задач (эталон = 21)
- [ ] **Обновить промпт:** Добавить требование `min_tasks = 21`
- [ ] **Проверить в коде:** Возможно, LLM ограничивается в количестве элементов
- [ ] **Добавить примеры:** Few-shot с 4-5 задачами в каждом разделе

**Метрика для проверки:**
```python
assert len(profile['responsibility_areas']) >= 4
assert all(len(area['tasks']) >= 4 for area in profile['responsibility_areas'])
assert sum(len(area['tasks']) for area in profile['responsibility_areas']) >= 21
```

---

### 1.2 Сократить длину обязанностей

- [x] **Текущее состояние:** 115 символов в среднем
- [x] **Целевое состояние:** 65 символов
- [ ] **Обновить промпт:** Добавить инструкцию о максимальной длине
- [ ] **Примеры правильных:** Показать примеры по 50-70 символов
- [ ] **Примеры неправильных:** Показать антипримеры (100+ символов)

**Инструкция для промпта:**
```markdown
ОБЯЗАННОСТИ:
- Максимальная длина одной обязанности: 70 символов
- Формат: [Действие] + [Объект] + [опциональный контекст]
- Начинать с существительного (Разработка, Контроль, Подготовка)
- Избегать: детальные технические спецификации, сложные условия, многоточечные перечисления

Примеры ПРАВИЛЬНЫХ (55-70 сим):
✓ "Разработка архитектурных разделов проектов (П, Р, РД)" (49 сим)
✓ "Контроль корректности архитектурной модели" (45 сим)
✓ "Подготовка рабочей документации и спецификаций" (51 сим)

Примеры НЕПРАВИЛЬНЫХ (>100 сим):
✗ "Разрабатывать архитектурные разделы проектов (концепции, П, Р, рабочая документация) в соответствии с техническим заданием и требованиями САО/РП." (145 сим)
✗ "Обеспечивать соответствие проектных решений ГОСТ/СНиП и внутренним стандартам компании (проверки до передачи на экспертизу)." (127 сим)
```

**Метрика для проверки:**
```python
avg_task_length = sum(len(task) for area in profile['responsibility_areas']
                      for task in area['tasks']) / total_tasks
assert avg_task_length < 75, f"Average task length {avg_task_length} exceeds 75"
```

---

### 1.3 Увеличить количество навыков

- [x] **Текущее состояние:** 10 навыков
- [x] **Целевое состояние:** 20-24 навыка
- [ ] **Обновить промпт:** Требование минимум 6 категорий x 3-4 навыка
- [ ] **Расширить категории:** Добавить управление временем и коммуникацию
- [ ] **Few-shot примеры:** Показать полный набор из 20 навыков

**Требуемая структура:**
```
Категория 1: Архитектурное проектирование (5 навыков)
Категория 2: Работа с документацией (5 навыков)
Категория 3: ПО и цифровые инструменты (5 навыков)
Категория 4: Нормативная документация (3 навыка)
Категория 5: Управление временем (2 навыка)
Категория 6: Коммуникация (2 навыка)
---
ИТОГО: 22 навыка минимум
```

**Инструкция для промпта:**
```markdown
ПРОФЕССИОНАЛЬНЫЕ НАВЫКИ:

1. ГЕНЕРИРУЕТСЯ В СЛЕДУЮЩЕМ ПОРЯДКЕ:
   а. Архитектурное проектирование (5 навыков)
   б. Работа с документацией и чертежами (5 навыков)
   в. Программное обеспечение (5 навыков)
   г. Нормативная документация (2-3 навыка)
   д. Управление временем и планирование (2 навыка)
   е. Коммуникация и взаимодействие (2 навыка)

2. ПАРАМЕТРЫ КАЖДОГО НАВЫКА:
   - Начинается с "Знание" или "Умение"
   - Длина: 45-75 символов
   - Не упоминаются конкретные инструменты (Revit, AutoCAD, JIRA)
   - Уровень владения: 1, 2 или 3 с разными описаниями
```

**Метрика для проверки:**
```python
assert len(profile['professional_skills']) >= 6, "Min 6 skill categories"
total_skills = sum(len(cat['specific_skills'])
                   for cat in profile['professional_skills'])
assert total_skills >= 20, f"Min 20 skills, got {total_skills}"
```

---

### 1.4 Исправить описания уровней владения

- [x] **Текущее состояние:** Уровни 2 и 3 имеют одинаковое описание
- [x] **Целевое состояние:** Разные описания для каждого уровня
- [ ] **Обновить промпт:** Явно указать описание каждого уровня
- [ ] **Обновить код:** Не копировать описание, использовать mapping

**Правильные описания:**
```json
{
  "level_1_description": "Базовые знания и опыт применения в стандартных ситуациях",
  "level_2_description": "Существенные знания и опыт применения в ситуациях повышенной сложности",
  "level_3_description": "Глубокие знания, опыт применения в кризисных ситуациях, готовность обучать других"
}
```

**Инструкция для промпта:**
```markdown
УРОВНИ ВЛАДЕНИЯ (proficiency_level):

Для КАЖДОГО уровня используется РАЗНОЕ описание:

- proficiency_level: 1
  proficiency_description: "Базовые знания и опыт применения в стандартных ситуациях"

- proficiency_level: 2
  proficiency_description: "Существенные знания и опыт применения в ситуациях повышенной сложности"

- proficiency_level: 3
  proficiency_description: "Глубокие знания, опыт применения в кризисных ситуациях, готовность обучать других"

НИКОГДА не копировать описание - для каждого уровня СВОЁ описание!
```

**Метрика для проверки:**
```python
descriptions = {}
for cat in profile['professional_skills']:
    for skill in cat['specific_skills']:
        level = skill['proficiency_level']
        desc = skill['proficiency_description']
        if level in descriptions:
            assert descriptions[level] == desc, f"Level {level} has different descriptions"
        descriptions[level] = desc

# Check that we have at least 3 different descriptions
assert len(set(descriptions.values())) == 3, "Must have 3 different level descriptions"
```

---

## Важные улучшения (Приоритет 2)

### 2.1 Убрать аббревиатуры и специфические инструменты

- [ ] **Найти все упоминания:** КР, ВИС, РД, ПД, БИМ, JIRA, Revit, AutoCAD и т.д.
- [ ] **Обновить примеры в промпте:** Показать как заменять
- [ ] **Добавить запрет:** Явный запрет на конкретные инструменты

**Примеры замены:**
```markdown
БЫЛО → СТАЛО

"Revit/BIM — моделирование архитектурных разделов..."
→ "Умение выполнять моделирование архитектурных объектов"

"AutoCAD и подготовка DWG-пакетов..."
→ "Умение готовить чертежи и оформлять проектную документацию"

"Работа с системами управления задачами (JIRA)"
→ "Умение работать с системами управления проектами"

"Координация архитектурных решений с КР, ВК, ОВ, ЭОМ"
→ "Умение координировать решения с конструкторскими и инженерными разделами"

"Знание и соблюдение внутренних стандартов А101: АТР АР, СТО АР"
→ "Знание и соблюдение внутренних стандартов проектирования"
```

**Инструкция для промпта:**
```markdown
ЗАПРЕЩЕНО в названиях навыков и задач:
- Конкретные инструменты: Revit, AutoCAD, JIRA, MS Project, Power BI, Confluence
- Аббревиатуры: БИМ, КР, ВИС, РД, ПД, ОВ, ЭОМ, АТР, СТО, ПМ, СМР, ТЭП
- Внутренние коды: САО, РП, ОПП, ЛКП, ГПР

Вместо этого используйте классы/типы:
- Revit → "САПР" или "инструменты моделирования"
- JIRA → "системы управления проектами"
- РД → "рабочая документация"
- АТР АР → "внутренние стандарты проектирования"
```

---

### 2.2 Минимизировать поля reasoning

- [ ] **Текущее:** 18+ полей reasoning по 5-10 строк каждое
- [ ] **Целевое:** 2-3 критичных поля по 1-2 строки
- [ ] **Удалить:** professional_skills_reasoning, responsibility_areas_reasoning, careerogram_reasoning
- [ ] **Оставить:** Только hierarchy_analysis и management_status_reasoning

**Рекомендуемая структура:**
```json
{
  "profile": {
    "reasoning_context_analysis": {
      "hierarchy_analysis": "...",  // 1-2 строки
      "management_status_reasoning": "..."  // 1-2 строки
    },
    "position_title": "...",
    "department_specific": "...",
    // ... остальные поля БЕЗ reasoning
  }
}
```

---

### 2.3 Добавить недостающие категории навыков

- [ ] **Категория 5:** "Управление временем и планирование"
  - Умение распределять время на выполнение поставленных задач
  - Умение оценить достаточность сроков на задачу

- [ ] **Категория 6:** "Коммуникация и взаимодействие в коллективе"
  - Умение эффективно взаимодействовать с командой
  - Умение четко доносить мысли в устной и письменной форме

---

## Желательные улучшения (Приоритет 3)

### 3.1 Добавить явную нумерованность разделов

**Текущий выход в Markdown:**
```markdown
## Разработка и проработка архитектурных решений
- Задача 1
- Задача 2

## Координация и взаимодействие
- Задача 1
```

**Целевой выход:**
```markdown
## 1. Разработка и проработка архитектурных решений
- Задача 1
- Задача 2

## 2. Координация и взаимодействие
- Задача 1
```

---

### 3.2 Перейти на существительные для задач

**Было (инфинитив):**
- "Разрабатывать архитектурные разделы"
- "Готовить рабочие чертежи"
- "Обеспечивать соответствие"

**Стало (существительное):**
- "Разработка архитектурных разделов"
- "Подготовка рабочих чертежей"
- "Обеспечение соответствия"

---

## Метрики качества для проверки

### После каждого обновления промпта

```python
def validate_profile_quality(profile):
    """Проверить качество профиля по метрикам эталона"""

    errors = []
    warnings = []

    # 1. Количество обязанностей
    total_tasks = sum(len(area['tasks'])
                      for area in profile['responsibility_areas'])
    if total_tasks < 20:
        errors.append(f"❌ Задач: {total_tasks} (требуется >= 20)")
    else:
        print(f"✓ Задач: {total_tasks}")

    # 2. Средняя длина обязанности
    task_lengths = [len(task)
                    for area in profile['responsibility_areas']
                    for task in area['tasks']]
    avg_task_len = sum(task_lengths) / len(task_lengths)
    if avg_task_len > 80:
        warnings.append(f"⚠ Средняя длина задачи: {avg_task_len:.0f} (предпочтительно < 75)")
    else:
        print(f"✓ Средняя длина задачи: {avg_task_len:.0f} символов")

    # 3. Количество навыков
    total_skills = sum(len(cat['specific_skills'])
                       for cat in profile['professional_skills'])
    if total_skills < 18:
        errors.append(f"❌ Навыков: {total_skills} (требуется >= 18)")
    else:
        print(f"✓ Навыков: {total_skills}")

    # 4. Категории навыков
    if len(profile['professional_skills']) < 6:
        warnings.append(f"⚠ Категорий навыков: {len(profile['professional_skills'])} (требуется >= 6)")
    else:
        print(f"✓ Категорий навыков: {len(profile['professional_skills'])}")

    # 5. Различимость уровней
    descriptions_by_level = {}
    for cat in profile['professional_skills']:
        for skill in cat['specific_skills']:
            level = skill['proficiency_level']
            desc = skill['proficiency_description']
            if level not in descriptions_by_level:
                descriptions_by_level[level] = desc
            elif descriptions_by_level[level] != desc:
                warnings.append(f"⚠ Уровень {level} имеет разные описания (нормально)")

    if len(set(descriptions_by_level.values())) == 1:
        errors.append(f"❌ Все уровни имеют одинаковое описание")
    else:
        print(f"✓ Уровни владения различимы ({len(descriptions_by_level)} разных)")

    # 6. Отсутствие аббревиатур
    forbidden_abbrev = ['БИМ', 'КР', 'ВИС', 'РД', 'ПД', 'JIRA', 'Revit', 'AutoCAD']
    all_text = json.dumps(profile)
    found_abbrev = [a for a in forbidden_abbrev if a in all_text]
    if found_abbrev:
        warnings.append(f"⚠ Найдены аббревиатуры: {found_abbrev}")
    else:
        print(f"✓ Нет запрещенных аббревиатур и инструментов")

    # Вывод
    print("\n" + "="*60)
    if errors:
        print("ОШИБКИ:")
        for err in errors:
            print(f"  {err}")
    if warnings:
        print("\nПРЕДУПРЕЖДЕНИЯ:")
        for warn in warnings:
            print(f"  {warn}")
    if not errors:
        print("✓ КАЧЕСТВО: ХОРОШЕЕ")
    else:
        print("❌ КАЧЕСТВО: ТРЕБУЕТ УЛУЧШЕНИЯ")

    return len(errors) == 0
```

---

## Итоговый чеклист для внедрения

### Этап 1: Подготовка (30 минут)
- [ ] Прочитать файл `/home/yan/A101/HR/docs/analysis/REFERENCE_VS_GENERATED_COMPARISON.md`
- [ ] Определить местоположение промпта генерации профилей
- [ ] Создать backup текущего промпта

### Этап 2: Обновление промпта (2-3 часа)
- [ ] Добавить требование к количеству обязанностей (1.1)
- [ ] Добавить инструкцию по ограничению длины (1.2)
- [ ] Добавить требование к количеству навыков (1.3)
- [ ] Исправить описания уровней владения (1.4)
- [ ] Убрать аббревиатуры (2.1)
- [ ] Минимизировать reasoning (2.2)

### Этап 3: Тестирование (1 час)
- [ ] Сгенерировать 3 тестовых профиля
- [ ] Проверить по метрикам качества (раздел выше)
- [ ] Сравнить с эталоном
- [ ] Внести корректировки

### Этап 4: Валидация (30 минут)
- [ ] Добавить автоматические проверки в pipeline
- [ ] Создать отчет о результатах
- [ ] Коммитить изменения в git

---

## Файлы для обновления

| Файл | Действие | Приоритет |
|------|----------|-----------|
| Промпт генерации | Обновить требования | P1 |
| Few-shot примеры | Заменить на примеры из эталона | P1 |
| Валидация результатов | Добавить метрики из раздела выше | P1 |
| Документация | Обновить описание процесса | P2 |
| Тесты | Добавить проверки качества | P2 |

---

**Статус:** Готово к внедрению
**Ожидаемый результат:** Повышение качества генерированных профилей с 5/10 до 9/10
